## CX3CL1/CX3CR1 in the CeA

The main target of the BLA is CeA.<!-- ładniej napisać// bardziej rozbudować -->
However, the basolateral and central complexes of the amygdala participate in different extended circuitries <!--citations--> and hence, the CX3CL1 may differentially regulate these networks. 
Thus, to gain insight into the CX3CL1-mediated regulation of the CeA circuitry, we examined cellular localization of CX3CL1 and CX3CR1 and the functional characteristics of CeA neurons.<!-- zmienić drugą część zdania... --> 
<!--the next step was to asses the cellular localization of CX3CL1 and its receptor, as well as their  electrophysiological effects. /// to gain insight into the CX3CL1-mediated regulation of the CeA circuitry, we examined the functional characteristic of the IPSCs in DG granule cells (Figure 1) and CA3 pyramidal neurons (Figure 2) in the dorsal and ventral hippocampus.  zmienić oczywiście...// they have different connectivity patterns -->


### Cellular distribution of CX3CL1 and CX3CR1 in the rat CeA

To gain greater insights about the cellular localization of CXCL12 and CXCR4, their expression was studied in rat brain slices by immunocytochemistry and fluorescence microscopy.

Molecular identification and characterization of fear controlling circuitries is a promising path towards developing targeted treatments of fear-related disorders.

### Electrophysiological classification of CeA neurons 

### CX3CL1/CX3CR1 modulation of the electrical properties in CeA neurons

#### Modulation of intrinsic membrane properties of CeL neurons by CX3CL1 in the cell-type specific manner

```{r CX3CL1CeAexcitabilitystats, include = FALSE}
# getting the table of statistics for all CeA df (LF + RS) condition of one experiment
CX3CL1_CeA_stat_all <- stat_table_exp_membr_extended((CeA_df_final))
CX3CL1_CeA_stat_2nM_all <- stat_table_exp_membr_extended(CeA_df_final %>% filter(Experiment == 'CX3CL1(2nM)'))
CX3CL1_CeA_stat_azdfrak2nM_all <- stat_table_exp_membr_extended(CeA_df_final %>% filter(Experiment == 'AZD8797 + \nCX3CL1(2nM)'))
CX3CL1_CeA_stat_minofrak2nM_all <- stat_table_exp_membr_extended(CeA_df_final %>% filter(Experiment == 'minocycline + \nCX3CL1(2nM)'))
# selecting a stat_row so it prints nicely in text
CX3CL1_CeA_stat_all_gain <- as.data.frame(CX3CL1_CeA_stat_all %>% dplyr::filter(Variable == 'gain') %>% dplyr::select(Statistics))
CX3CL1_CeA_stat_frak2nM_gain <- CX3CL1_CeA_stat_all_gain$Statistics[1]
CX3CL1_CeA_stat_azdfrak_gain <- CX3CL1_CeA_stat_all_gain$Statistics[2]
CX3CL1_CeA_stat_azd_gain <- CX3CL1_CeA_stat_all_gain$Statistics[3]
CX3CL1_CeA_stat_minofrak_gain <- CX3CL1_CeA_stat_all_gain$Statistics[4]
CX3CL1_CeA_stat_mino_gain <- CX3CL1_CeA_stat_all_gain$Statistics[5]

CX3CL1_CeA_stat_all_Rm <- as.data.frame(CX3CL1_CeA_stat_all %>% dplyr::filter(Variable == 'Input_resistance') %>% dplyr::select(Statistics)) 
CX3CL1_CeA_stat_frak2nM_Rm <- CX3CL1_CeA_stat_all_Rm$Statistics[1]
CX3CL1_CeA_stat_azdfrak_Rm <- CX3CL1_CeA_stat_all_Rm$Statistics[2]
CX3CL1_CeA_stat_azd_Rm <- CX3CL1_CeA_stat_all_Rm$Statistics[3]
CX3CL1_CeA_stat_minofrak_Rm <- CX3CL1_CeA_stat_all_Rm$Statistics[4]
CX3CL1_CeA_stat_mino_Rm <- CX3CL1_CeA_stat_all_Rm$Statistics[5]

CX3CL1_CeA_stat_all_tau <- as.data.frame(CX3CL1_CeA_stat_all %>% dplyr::filter(Variable == 'tau') %>% dplyr::select(Statistics))
CX3CL1_CeA_stat_frak2nM_tau <- CX3CL1_CeA_stat_all_tau$Statistics[1]
CX3CL1_CeA_stat_azdfrak_tau <- CX3CL1_CeA_stat_all_tau$Statistics[2]
CX3CL1_CeA_stat_azd_tau <- CX3CL1_CeA_stat_all_tau$Statistics[3]
CX3CL1_CeA_stat_minofrak_tau <- CX3CL1_CeA_stat_all_tau$Statistics[4]
CX3CL1_CeA_stat_mino_tau <- CX3CL1_CeA_stat_all_tau$Statistics[5]

CX3CL1_CeA_stat_all_Vm <- as.data.frame(CX3CL1_CeA_stat_all %>% dplyr::filter(Variable == 'Vm') %>% dplyr::select(Statistics))
CX3CL1_CeA_stat_frak2nM_Vm <- CX3CL1_CeA_stat_all_Vm$Statistics[1]
CX3CL1_CeA_stat_azdfrak_Vm <- CX3CL1_CeA_stat_all_Vm$Statistics[2]
CX3CL1_CeA_stat_azd_Vm <- CX3CL1_CeA_stat_all_Vm$Statistics[3]
CX3CL1_CeA_stat_minofrak_Vm <- CX3CL1_CeA_stat_all_Vm$Statistics[4]
CX3CL1_CeA_stat_mino_Vm <- CX3CL1_CeA_stat_all_Vm$Statistics[5]

#### RS
CX3CL1_CeA_stat_RS <- stat_table_exp_membr_extended((CeA_df_final_RS))

# selecting a stat_row so it prints nicely in text
CX3CL1_CeA_stat_RS_all_gain <- as.data.frame(CX3CL1_CeA_stat_RS %>% dplyr::filter(Variable == 'gain') %>% dplyr::select(Statistics))
CX3CL1_CeA_stat_frak2nM_RS_gain <- CX3CL1_CeA_stat_RS_all_gain$Statistics[1]
CX3CL1_CeA_stat_azdfrak_RS_gain <- CX3CL1_CeA_stat_RS_all_gain$Statistics[2]
CX3CL1_CeA_stat_azd_RS_gain <- CX3CL1_CeA_stat_RS_all_gain$Statistics[3]
CX3CL1_CeA_stat_minofrak_RS_gain <- CX3CL1_CeA_stat_RS_all_gain$Statistics[4]
CX3CL1_CeA_stat_mino_RS_gain <- CX3CL1_CeA_stat_RS_all_gain$Statistics[5]

CX3CL1_CeA_stat_RS_all_Rm <- as.data.frame(CX3CL1_CeA_stat_RS %>% dplyr::filter(Variable == 'Input_resistance') %>% dplyr::select(Statistics)) 
CX3CL1_CeA_stat_frak2nM_RS_Rm <- CX3CL1_CeA_stat_RS_all_Rm$Statistics[1]
CX3CL1_CeA_stat_azdfrak_RS_Rm <- CX3CL1_CeA_stat_RS_all_Rm$Statistics[2]
CX3CL1_CeA_stat_azd_RS_Rm <- CX3CL1_CeA_stat_RS_all_Rm$Statistics[3]
CX3CL1_CeA_stat_minofrak_RS_Rm <- CX3CL1_CeA_stat_RS_all_Rm$Statistics[4]
CX3CL1_CeA_stat_mino_RS_Rm <- CX3CL1_CeA_stat_RS_all_Rm$Statistics[5]

CX3CL1_CeA_stat_RS_all_tau <- as.data.frame(CX3CL1_CeA_stat_RS %>% dplyr::filter(Variable == 'tau') %>% dplyr::select(Statistics))
CX3CL1_CeA_stat_frak2nM_RS_tau <- CX3CL1_CeA_stat_RS_all_tau$Statistics[1]
CX3CL1_CeA_stat_azdfrak_RS_tau <- CX3CL1_CeA_stat_RS_all_tau$Statistics[2]
CX3CL1_CeA_stat_azd_RS_tau <- CX3CL1_CeA_stat_RS_all_tau$Statistics[3]
CX3CL1_CeA_stat_minofrak_RS_tau <- CX3CL1_CeA_stat_RS_all_tau$Statistics[4]
CX3CL1_CeA_stat_mino_RS_tau <- CX3CL1_CeA_stat_RS_all_tau$Statistics[5]

CX3CL1_CeA_stat_RS_all_Vm <- as.data.frame(CX3CL1_CeA_stat_RS %>% dplyr::filter(Variable == 'Vm') %>% dplyr::select(Statistics))
CX3CL1_CeA_stat_frak2nM_RS_Vm <- CX3CL1_CeA_stat_RS_all_Vm$Statistics[1]
CX3CL1_CeA_stat_azdfrak_RS_Vm <- CX3CL1_CeA_stat_RS_all_Vm$Statistics[2]
CX3CL1_CeA_stat_azd_RS_Vm <- CX3CL1_CeA_stat_RS_all_Vm$Statistics[3]
CX3CL1_CeA_stat_minofrak_RS_Vm <- CX3CL1_CeA_stat_RS_all_Vm$Statistics[4]
CX3CL1_CeA_stat_mino_RS_Vm <- CX3CL1_CeA_stat_RS_all_Vm$Statistics[5]


#### LF
CX3CL1_CeA_stat_LF <- stat_table_exp_membr_extended((CeA_df_final_LF))

# selecting a stat_row so it prints nicely in text
CX3CL1_CeA_stat_LF_all_gain <- as.data.frame(CX3CL1_CeA_stat_LF %>% dplyr::filter(Variable == 'gain') %>% dplyr::select(Statistics))
CX3CL1_CeA_stat_frak2nM_LF_gain <- CX3CL1_CeA_stat_LF_all_gain$Statistics[1]
CX3CL1_CeA_stat_azdfrak_LF_gain <- CX3CL1_CeA_stat_LF_all_gain$Statistics[2]
CX3CL1_CeA_stat_azd_LF_gain <- CX3CL1_CeA_stat_LF_all_gain$Statistics[3]
CX3CL1_CeA_stat_minofrak_LF_gain <- CX3CL1_CeA_stat_LF_all_gain$Statistics[4]
CX3CL1_CeA_stat_mino_LF_gain <- CX3CL1_CeA_stat_LF_all_gain$Statistics[5]

CX3CL1_CeA_stat_LF_all_Rm <- as.data.frame(CX3CL1_CeA_stat_LF %>% dplyr::filter(Variable == 'Input_resistance') %>% dplyr::select(Statistics)) 
CX3CL1_CeA_stat_frak2nM_LF_Rm <- CX3CL1_CeA_stat_LF_all_Rm$Statistics[1]
CX3CL1_CeA_stat_azdfrak_LF_Rm <- CX3CL1_CeA_stat_LF_all_Rm$Statistics[2]
CX3CL1_CeA_stat_azd_LF_Rm <- CX3CL1_CeA_stat_LF_all_Rm$Statistics[3]
CX3CL1_CeA_stat_minofrak_LF_Rm <- CX3CL1_CeA_stat_LF_all_Rm$Statistics[4]
CX3CL1_CeA_stat_mino_LF_Rm <- CX3CL1_CeA_stat_LF_all_Rm$Statistics[5]

CX3CL1_CeA_stat_LF_all_tau <- as.data.frame(CX3CL1_CeA_stat_LF %>% dplyr::filter(Variable == 'tau') %>% dplyr::select(Statistics))
CX3CL1_CeA_stat_frak2nM_LF_tau <- CX3CL1_CeA_stat_LF_all_tau$Statistics[1]
CX3CL1_CeA_stat_azdfrak_LF_tau <- CX3CL1_CeA_stat_LF_all_tau$Statistics[2]
CX3CL1_CeA_stat_azd_LF_tau <- CX3CL1_CeA_stat_LF_all_tau$Statistics[3]
CX3CL1_CeA_stat_minofrak_LF_tau <- CX3CL1_CeA_stat_LF_all_tau$Statistics[4]
CX3CL1_CeA_stat_mino_LF_tau <- CX3CL1_CeA_stat_LF_all_tau$Statistics[5]

CX3CL1_CeA_stat_LF_all_Vm <- as.data.frame(CX3CL1_CeA_stat_LF %>% dplyr::filter(Variable == 'Vm') %>% dplyr::select(Statistics))
CX3CL1_CeA_stat_frak2nM_LF_Vm <- CX3CL1_CeA_stat_LF_all_Vm$Statistics[1]
CX3CL1_CeA_stat_azdfrak_LF_Vm <- CX3CL1_CeA_stat_LF_all_Vm$Statistics[2]
CX3CL1_CeA_stat_azd_LF_Vm <- CX3CL1_CeA_stat_LF_all_Vm$Statistics[3]
CX3CL1_CeA_stat_minofrak_LF_Vm <- CX3CL1_CeA_stat_LF_all_Vm$Statistics[4]
CX3CL1_CeA_stat_mino_LF_Vm <- CX3CL1_CeA_stat_LF_all_Vm$Statistics[5]
```

The next step was to investigate whether reduced excitability of CX3CL1 in the BLA<!--,together with ....,--> would affect the membrane properties of their main target, i.e., GABAergic cells in the CeL.
<!-- razem z tym, że on sam też może mieć udział... --> 
To this end, among others, electrophysiological features such as the excitability, input resistance, membrane time constant, resting membrane potential, was measured (see: Methods \@ref(electroprotocols)). <!-- analogous to the neurons in the BLA./// recorded using a whole-cell patch-clamp approach, in a current-clamp configuration.-->

In general, these experiments revealed that several membrane properties in the CeL neurons were significantly modified by CX3CL1 (Fig. \@ref(fig:CX3CL1CeAintrinsic)). 
Specifically, similar to what was observed in the BLA, bath application of CX3CL1 (2nM) produced a <!--reversible--> decrease in the number of action potentials evoked by a given current step, manifested as a decrease in gain (baseline = `r round(CeA_df_final %>% filter(Experiment == 'CX3CL1(2nM)' & Condition == "baseline") %>% ungroup() %>% summarize(mean(gain)), digits = 2)` `r knitr::asis_output("\U00B1")` `r round(CeA_df_final %>% filter(Experiment == 'CX3CL1(2nM)' & Condition == "baseline") %>% ungroup() %>% dplyr::summarize(x = sd(gain), count = n()) %>% dplyr::summarize(x/sqrt(count)), digits = 3)`, CX3CL1(2nM) = `r round(CeA_df_final %>% filter(Experiment == 'CX3CL1(2nM)' & Condition == "CX3CL1") %>% ungroup() %>% summarize(mean(gain)), digits = 2)` `r knitr::asis_output("\U00B1")` `r round(CeA_df_final %>% filter(Experiment == 'CX3CL1(2nM)' & Condition == "CX3CL1") %>% ungroup() %>% dplyr::summarize(x = sd(gain), count = n()) %>% dplyr::summarize(x/sqrt(count)), digits = 3)`, `r CX3CL1_CeA_stat_frak2nM_gain`, see Fig. \@ref(fig:CX3CL1CeAintrinsic)<!--jaki?-->).<!-- który panel?--><!--  We injected a series of depolarizing current steps to assess the number of action potentials (Figure 4a – c). Repeated-measure ANOVA revealed that projection neurons fired significantly less after NF knockdown // Bath application of DA (0.05–30 μm) produced a reversible decrease in the number of action potentials evoked by a given current step-->
This effect was accompanied by decreased input resistance (`r CX3CL1_CeA_stat_frak2nM_Rm`) and membrane time constant (`r CX3CL1_CeA_stat_frak2nM_tau`; Fig. \@ref(fig:CX3CL1CeAintrinsic)<!--jaki?-->).
Moreover, resting membrane potentials of CeL neurons become more depolarized in response to bath-applied 2nM CX3CL1 (from `r round(CeA_df_final %>% filter(Experiment == 'CX3CL1(2nM)' & Condition == "baseline") %>% ungroup() %>% summarize(mean(RMS)), digits = 2)` `r knitr::asis_output("\U00B1")` `r round(CeA_df_final %>% filter(Experiment == 'CX3CL1(2nM)' & Condition == "baseline") %>% ungroup() %>% dplyr::summarize(x = sd(RMS), count = n()) %>% dplyr::summarize(x/sqrt(count)), digits = 3)` to `r round(CeA_df_final %>% filter(Experiment == 'CX3CL1(2nM)' & Condition == "CX3CL1") %>% ungroup() %>% summarize(mean(RMS)), digits = 2)` `r knitr::asis_output("\U00B1")` `r round(CeA_df_final %>% filter(Experiment == 'CX3CL1(2nM)' & Condition == "CX3CL1") %>% ungroup() %>% dplyr::summarize(x = sd(RMS), count = n()) %>% dplyr::summarize(x/sqrt(count)), digits = 3)`, `r CX3CL1_CeA_stat_frak2nM_Vm`) (Fig. \@ref(fig:CX3CL1CeAintrinsic)<!--jaki?-->).<!-- In response to bath-applied agonists, the depolarization is strong enough that it is capable of producing prolonged spiking ( Beierlein et al., 2000; Fanselow et al., 2008; Kawaguchi, 1997; Xu et al., 2013 ).-->

Given that CeL neurons demonstrate mainly two types of electrophysiological firing patterns, specifically Regular-Spiking and Late-Firing neurons (see Introduction, CeA subchapter \@ref(CeA) and Fig. \@ref(fig:methodsBLACeAIVrep)b),<!-- which was also confirmed by cluster analysis from recorded CeL cells as a part of this dissertation,comprises neurons of two main electrophysiological types // La  ter studies further characterized at least four main physiological types of neurons in the CeA, distinguished based on their responses to intracellular current injections.-->, previously measured intrinsic parameters were further analyzed<!--divided?--> by these neuronal subtypes.<!-- odnośnik do góry i lepiej napisać// segregated those neurons according to their types.-->
Intriguingly, majority of RS neurons were revealed to respond to CX3CL1, which was reflected as robust changes in intrinsic properties (Fig. \@ref(fig:CX3CL1CeAintrinsic)<!--part-->).
In contrast, under presented here experimental conditions, CX3CL1 seems not to affect LF cells' intrinsic membrane properties (see Fig. \@ref(fig:CX3CL1CeAintrinsic)<!--part-->), implying that much higher proportion of RS cells was reactive to CX3CL1.
All parameters and statistics are summarized in Table <!--?-->.

```{r CX3CL1CeAintrinsic, fig.cap='**Effects of CX3CL1 on intrinsic properties of CeL neurons** **(a)** Schematics of presented conditions **(b)** Boxplots presenting each cell before and after CX3CL1 application across different conditions **(d)** plots presenting input-output relationships of representative cells **e** representative voltage traces from representative cells to 300, 360 and 400pA injection currents prior to (blue) and after the CX3CL1 application (red) in the ... conditions of electrophysiological recordings. Scale bar: 10mV, 10ms ', fig.align = 'center', echo = FALSE, message= FALSE, echo = FALSE, warning= FALSE, message = FALSE, fig.width= 15, fig.height= 18}

#knitr::include_graphics("images/results//CX3CL1_BLA_excitability.png")
#knitr::include_graphics("images/results//CX3CL1_BLA_excitability.png")

inset_frak2nM <- image_read("images//results//inset_frak2nM.png")
inset_frak2nM <- image_ggplot(inset_frak2nM)
inset_azdfrak2nM <- image_read("images//results//inset_azdfrak2nM.png")
inset_azdfrak2nM <- image_ggplot(inset_azdfrak2nM)
inset_azda <- image_read("images//results//inset_azd.png")
inset_azda <- image_ggplot(inset_azda)
inset_minofrak2nM <- image_read("images//results//inset_minofrak2nM.png")
inset_minofrak2nM <- image_ggplot(inset_minofrak2nM)
inset_minoa <- image_read("images//results//inset_minoa.png")
inset_minoa <- image_ggplot(inset_minoa)


# making labels (as minocycline and azd has different condition than CX3CL1) for then making proper automatic statistics
# f_labels_BLA_thres <- data.frame(Experiment = c( c("CX3CL1(2nM)" , "CX3CL1(5nM)", 'anti-CX3CR1 + \nCX3CL1(2nM)', "AZD8797 + \nCX3CL1(2nM)", "AZD8797", 'minocycline + \nCX3CL1(2nM)' , "minocycline" , 'picrotoxin + \nCGP52432 + \nCX3CL1(2nM)' )), label = c("", "", "", "", "", "", "*", ""))
# f_labels_BLA_thres$Experiment <- factor(f_labels_BLA_thres$Experiment, levels = c("CX3CL1(2nM)" , "CX3CL1(5nM)", 'anti-CX3CR1 + \nCX3CL1(2nM)', "AZD8797 + \nCX3CL1(2nM)", "AZD8797", 'minocycline + \nCX3CL1(2nM)' , "minocycline" , 'picrotoxin + \nCGP52432 + \nCX3CL1(2nM)'))

## subsetting only CX3CL1 conditions
CeA_df_final_sub <- CeA_df_final %>% dplyr::filter(Experiment %in% c("CX3CL1(2nM)", "AZD8797 + \nCX3CL1(2nM)", "minocycline + \nCX3CL1(2nM)"))
CeA_df_final_sub_RS <- CeA_df_final_RS %>% dplyr::filter(Experiment %in% c("CX3CL1(2nM)", "AZD8797 + \nCX3CL1(2nM)", "minocycline + \nCX3CL1(2nM)"))
CeA_df_final_sub_LF <- CeA_df_final_LF %>% dplyr::filter(Experiment %in% c("CX3CL1(2nM)", "AZD8797 + \nCX3CL1(2nM)", "minocycline + \nCX3CL1(2nM)"))

# GAIN
bp_CeA_gain <- plot_boxplot(CeA_df_final_sub, gain, mtitle= "CeL - All Neurons", ylabel = "gain",  dot_size = 2)
bp_CeA_gain <- bp_CeA_gain + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),
 strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)

bp_CeA_gain_RS <- plot_boxplot(CeA_df_final_sub_RS, gain, mtitle= "CeL - All Neurons", ylabel = "gain",  dot_size = 2)
bp_CeA_gain_RS <- bp_CeA_gain_RS + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),
 strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)

bp_CeA_gain_LF <- plot_boxplot(CeA_df_final_sub_LF, gain, mtitle= "CeL - All Neurons", ylabel = "gain",  dot_size = 2)
bp_CeA_gain_LF <- bp_CeA_gain_LF + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),
 strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)

# THRESHOLD CURRENT

# f_labels_CeA_thres <- data.frame(Experiment = c( c("CX3CL1(2nM)",  "AZD8797 + \nCX3CL1(2nM)", "AZD8797", "minocycline + \nCX3CL1(2nM)" , "minocycline" )), label = c("", "", "*", "", ""))
# f_labels_CeA_thres$Experiment <- factor(f_labels_CeA_thres$Experiment, levels = c("CX3CL1(2nM)", "AZD8797 + \nCX3CL1(2nM)", "AZD8797", "minocycline + \nCX3CL1(2nM)" , "minocycline"))
# 
# bp_CeA_thres <- plot_boxplot(CeA_df_final, Treshold1_all, mtitle= "CeA - All Cells", ylabel = "Threshold current (mV)", vary1 = -60, vary2 = -20, dot_size = 2)
# bp_CeA_thres <- bp_CeA_thres + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5)) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE) + geom_text(x = 1.5, y = -20, aes(label = label, color = NULL, group= NULL), data = f_labels_CeA_thres)
# 
# ADAPTATION
# bp_CeA_adap <- plot_boxplot(CeA_df_final, Adaptation_ratio, mtitle= "CeA - All Cells", ylabel = "Adaptation ratio", vary1 = 0, vary2 = 2, dot_size = 2)
# bp_CeA_adap <- bp_CeA_adap + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5)) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)
# # INPUT RESISTANCE
bp_CeA_rm <- plot_boxplot(CeA_df_final_sub, Rm_20, mtitle= "CeA - All Cells", ylabel = "Input resistance (MOhm)", vary1 = 100, vary2 = 900, dot_size = 2)
bp_CeA_rm <- bp_CeA_rm + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),
 strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 'wilcox.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)

bp_CeA_rm_RS <- plot_boxplot(CeA_df_final_sub_RS, Rm_20, mtitle= "CeA - All Cells", ylabel = "Input resistance (MOhm)", vary1 = 100, vary2 = 900, dot_size = 2)
bp_CeA_rm_RS <- bp_CeA_rm_RS + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),
 strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 'wilcox.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)

bp_CeA_rm_LF <- plot_boxplot(CeA_df_final_sub_LF, Rm_20, mtitle= "CeA - All Cells", ylabel = "Input resistance (MOhm)", vary1 = 100, vary2 = 900, dot_size = 2)
bp_CeA_rm_LF <- bp_CeA_rm_LF + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),
 strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 'wilcox.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)

# TAU
bp_CeA_tau <- plot_boxplot(CeA_df_final_sub, tau_20, mtitle= "CeA - All Cells", ylabel = "tau (ms)", vary1 = 0, vary2 = 40, dot_size = 2)
bp_CeA_tau <- bp_CeA_tau + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),
 strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)

bp_CeA_tau_RS <- plot_boxplot(CeA_df_final_sub_RS, tau_20, mtitle= "CeA - All Cells", ylabel = "tau (ms)", vary1 = 0, vary2 = 40, dot_size = 2)
bp_CeA_tau_RS <- bp_CeA_tau_RS + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),
 strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)

bp_CeA_tau_LF <- plot_boxplot(CeA_df_final_sub_LF, tau_20, mtitle= "CeA - All Cells", ylabel = "tau (ms)", vary1 = 0, vary2 = 40, dot_size = 2)
bp_CeA_tau_LF <- bp_CeA_tau_LF + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),
 strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)

# CAPACITANCE
# f_labels_CeA_cap <- data.frame(Experiment = c( c("CX3CL1(2nM)", "AZD8797 + \nCX3CL1(2nM)", "AZD8797", "minocycline + \nCX3CL1(2nM)" , "minocycline")), label = c("", "", "", "", "*"))
# f_labels_CeA_cap$Experiment <- factor(f_labels_CeA_cap$Experiment, levels = c("CX3CL1(2nM)" ,"AZD8797 + \nCX3CL1(2nM)", "AZD8797", "minocycline + \nCX3CL1(2nM)" , "minocycline"))
# bp_CeA_cap <- plot_boxplot(CeA_df_final, C_20, mtitle= "CeA - All Cells", ylabel = "Capacitance (pF)", vary1 = 30, vary2 = 155, dot_size = 2)
# bp_CeA_cap <- bp_CeA_cap + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5)) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE) + geom_text(x = 1.5, y = 130, aes(label = label, color = NULL, group= NULL), data = f_labels_CeA_cap)

# SAG
# bp_CeA_sag <- plot_boxplot(CeA_df_sag, sag_ratio_140, mtitle= "CeA - All Cells", ylabel = "sag ratio @-140 pA", dot_size = 2)
# bp_CeA_sag <- bp_CeA_sag + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5))

# RESTING MEMBRANE POTENTIAL
bp_CeA_vm <- plot_boxplot(CeA_df_final_sub, RMS, mtitle= "CeA - All Cells", ylabel = "Resting membrane potential (mV)", vary1 = -80, vary2 = -25, dot_size = 2)
bp_CeA_vm <- bp_CeA_vm + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),
 strip.text = element_text(size = 11, face="bold"), strip.background = element_blank())

bp_CeA_vm_RS <- plot_boxplot(CeA_df_final_sub_RS, RMS, mtitle= "CeA - All Cells", ylabel = "Resting membrane potential (mV)", vary1 = -80, vary2 = -25, dot_size = 2)
bp_CeA_vm_RS <- bp_CeA_vm_RS + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),
 strip.text = element_text(size = 11, face="bold"), strip.background = element_blank())  + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)

bp_CeA_vm_LF <- plot_boxplot(CeA_df_final_sub_LF, RMS, mtitle= "CeA - All Cells", ylabel = "Resting membrane potential (mV)", vary1 = -80, vary2 = -25, dot_size = 2)
bp_CeA_vm_LF <- bp_CeA_vm_LF + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),
 strip.text = element_text(size = 11, face="bold"), strip.background = element_blank())

# ACTION POTENTIAL WIDTH
# bp_CeA_apw <- plot_boxplot(CeA_df_final, AP_width1_all, mtitle= "CeA - All Cells", ylabel = "Action potential width (ms)", vary1 = 0.5, vary2 = 2.5, dot_size = 2)
# bp_CeA_apw <- bp_CeA_apw + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5)) # + stat_compare_means(method = 'wilcox.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)

# ACTION POTENTIAL AMPLITUDE
# bp_CeA_apa <- plot_boxplot(CeA_df_final, AP_amp1_all, mtitle= "CeA - All Cells", ylabel = "Action potential amplitude (pA)", vary1 = 50, vary2 = 120, dot_size = 2)
# bp_CeA_apa <- bp_CeA_apa + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5)) #+ stat_compare_means(method = 'wilcox.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)


# FAST AHP
# bp_CeA_fast <- plot_boxplot(CeA_df_final, AHPf1_all, mtitle= "CeA - All Cells", ylabel = "fast AHP (pA)", vary1 = -25, vary2 = 7, dot_size = 2)
# bp_CeA_fast <- bp_CeA_fast + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5)) #+ stat_compare_means(method = 'wilcox.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)


### making representative plots 
## frak2nM
frak2nM_IV_subset <- CeA_df_final %>% filter(Experiment == "CX3CL1(2nM)" & Cell %in% c(22)) # subtracting one representative cell from whole dataframe
frak2nM_IV_subset$Filename_all1[frak2nM_IV_subset$Filename_all1 == "21303018"] = "CX3CL1(2nM)" #renaming the name - instead the name of the file - the name of the condition
representative_frak2nM <- frak2nM_IV_subset %>% plot_IV_individual(mtitle = "") + theme(strip.text = element_text(size = 11, face="bold"), strip.background = element_blank(), plot.margin = unit(c(0.25,0.25,0.25,0.25), "cm")) # making a plot
# ## importing traces
# 
# ## azdfrak2nM
azdfrak2nM_IV_subset <- CeA_df_final %>% filter(Experiment == "AZD8797 + \nCX3CL1(2nM)") %>% filter(Cell %in% c(26))
azdfrak2nM_IV_subset$Filename_all1[azdfrak2nM_IV_subset$Filename_all1 == "20611001"] = "AZD8797 + \nCX3CL1(2nM)"
representative_azdfrak2nM <- azdfrak2nM_IV_subset %>% plot_IV_individual(mtitle = "") + theme(strip.text = element_text(size = 11, face="bold"), strip.background = element_blank(), plot.margin = unit(c(0.25,0.25,0.25,0.25), "cm")) #+ xlim(300, 500) + ylim(0, 12)
# 
## minofrak2nM
minofrak2nM_IV_subset <- CeA_df_final %>% filter(Experiment == "minocycline + \nCX3CL1(2nM)") %>% filter(Cell %in% c(46))
minofrak2nM_IV_subset$Filename_all1[minofrak2nM_IV_subset$Filename_all1 == "20703013"] = "minocycline + \nCX3CL1(2nM)"
representative_minofrak2nM <- minofrak2nM_IV_subset %>% plot_IV_individual(mtitle = "") + theme(strip.text = element_text(size = 11, face="bold"), strip.background = element_blank(), plot.margin = unit(c(0.25,0.25,0.25,0.25), "cm")) #+ xlim(260, 500)
# 
#powinny być nowe IV_representative_minoa <- fig("images//results//IV_representative_minoa.png", aspect.ratio = "free", b_pos = "inside", b_size = 0, b_margin =  ggplot2::margin(0, 0, 0, 0))
traces_frak2nM <- fig("images//results//CX3CL1_CeA_IV_traces_frak2nM.png", aspect.ratio = "free", b_pos = "inside", b_size = 0, b_margin =  ggplot2::margin(0, 0, 0, 0))
traces_azdfrak <- fig("images//results//CX3CL1_CeA_IV_traces_azdfrak.png", aspect.ratio = "free", b_pos = "inside", b_size = 0, b_margin =  ggplot2::margin(0, 0, 0, 0))
traces_minofrak <- fig("images//results//CX3CL1_CeA_IV_traces_minofrak.png", aspect.ratio = "free", b_pos = "inside", b_size = 0, b_margin =  ggplot2::margin(0, 0, 0, 0))

### general representative IV figure
#figure_IV <- representative_frak2nM | representative_azdfrak2nM | representative_minofrak2nM

#using patchwork to do layout of the figure

# f_labels_BLA_thres_add <- data.frame(Experiment = c( c(  "AZD8797", "minocycline" )), label = c("", "*"))
# f_labels_BLA_thres_add$Experiment <- factor(f_labels_BLA_thres_add$Experiment, levels = c( "AZD8797",  "minocycline"))
# 
#  + geom_text(x = 1.5, y = -20, aes(label = label, color = NULL, group= NULL), data = f_labels_BLA_thres_add, size=12, face = 'bold') 
# figure2 <- ((representative_azdfrak2nM | traces_azdfrak) + plot_layout(tag_level = 'new')) | ((representative_minofrak2nM | traces_minofrak)+ plot_layout(tag_level = 'new'))  +  plot_layout(guides = "collect") & theme(legend.position = "bottom")

figure1 <- ((bp_CeA_gain | bp_CeA_gain_RS | bp_CeA_gain_LF) + plot_layout(tag_level = 'new')) / 
           ((bp_CeA_rm | bp_CeA_rm_RS | bp_CeA_rm_LF) + plot_layout(tag_level = 'new')) / 
           ((bp_CeA_tau | bp_CeA_tau_RS | bp_CeA_tau_LF) + plot_layout(tag_level = 'new'))/
           ((bp_CeA_vm | bp_CeA_vm_RS | bp_CeA_vm_LF) + plot_layout(tag_level = 'new')) / 
           ((representative_frak2nM | traces_frak2nM | representative_azdfrak2nM | traces_azdfrak | representative_minofrak2nM | traces_minofrak) + plot_layout(tag_level = 'new'))

# figure1 <-  ((inset_frak2nM | inset_frak5nM | inset_ab | inset_azdfrak2nM | inset_minofrak2nM | inset_gaba)  + plot_layout(tag_level = 'new')) /
#  (bp_BLA_thres + theme(legend.position = "none"))  /
#   (((pie_BLA_frak_thres | pie_BLA_frak5nM_thres | pie_BLA_antifrak_thres | pie_BLA_azdfrak_thres | pie_BLA_minofrak_thres | pie_BLA_picro_thres)  + plot_layout(tag_level = 'new')) +  plot_layout(guides = "collect") & theme(legend.position = "bottom")) / 
#   (((((representative_frak2nM | representative_azdfrak2nM | representative_minofrak2nM | representative_gabafrak2nM) + plot_layout(tag_level = 'new')) +   plot_layout(tag_level = 'new')) + plot_layout(guides = "collect") & theme(legend.position = "right")))  +
#     (IV_representative_frak2nM | IV_representative_azdfrak2nM | IV_representative_minofrak2nM | IV_representative_gabafrak2nM)


figure1 <- figure1 + 
   plot_annotation(tag_levels = c('a', '1')) #+ plot_layout(heights = c(0.3, 0.7, 1, 0.5, 1))

figure1

```


```{r CX3CL1CeAintrinsictable, echo = FALSE, message= FALSE, echo = FALSE, warning= FALSE, message = FALSE, fig.width= 15, fig.height= 18}

CeA_df_table <- CeA_df_final %>% dplyr::select(Experiment, Filename_all1, Cell, Condition, Type, RMS, Rm_20, gain)

CeA_df_sum <- CeA_df_table %>% group_by(Experiment) %>% dplyr::summarise(RMS)

```

#### Excitatory synaptic transmission in the CeL and its effect by CX3CL12

Considering the observed reduction in RS cells' excitability, 


 Neurons in both regions also make extensive local connections (McDonald, 1982; Sun and Cassell, 1993; Jolkkonen and Pitkänen, 1998), with local glutamate excitation of CeL neurons evoking IPSCs in neighboring neurons (Lopez de Armentia and Sah, 2004).

#### Effects of CX3CL1 on the inhibitory synaptic transmission in the CeL

<!-- two major classes of CeL neurons with distinct firing patterns,-->