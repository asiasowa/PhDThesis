## CXCL12/CXCR4 signaling in the basolateral nucleus of the amygdala

### CXCL12 does not significantly modulate the electrophysiological actions in the BLA

``` {r CXCL12BLAstats, echo = FALSE, message= FALSE, echo = FALSE, warning = FALSE, message = FALSE, fig.width= 15, fig.height= 18}
CXCL12_BLA_membr_stat_all <- stat_table_exp_membr_extended((BLA_df_final_12))
BLA_sEPSC_final_12$Experiment <- as.factor(BLA_sEPSC_final_12$Experiment)
BLA_sEPSC_final_12$Cell <- as.factor(BLA_sEPSC_final_12$Cell)
BLA_sEPSC_final_12$Condition <- as.factor(BLA_sEPSC_final_12$Condition)
CXCL12_BLA_sEPSC_stat_all <- stat_table_exp_syn_extended(BLA_sEPSC_final_12)
CXCL12_2nM_BLA_sEPSC_stat_all <- CXCL12_BLA_sEPSC_stat_all %>% dplyr::filter(Experiment == 'CXCL12(2nM)')
CXCL12_2nM_BLA_sEPSC_stat_freq <- CXCL12_2nM_BLA_sEPSC_stat_all$Statistics[1]
CXCL12_5nM_BLA_sEPSC_stat_all <- CXCL12_BLA_sEPSC_stat_all %>% dplyr::filter(Experiment == 'CXCL12(5nM)')
CXCL12_5nM_BLA_sEPSC_stat_freq <- CXCL12_5nM_BLA_sEPSC_stat_all$Statistics[1]

BLA_sIPSC_final_12$Experiment <- as.factor(BLA_sIPSC_final_12$Experiment)
BLA_sIPSC_final_12$Cell <- as.factor(BLA_sIPSC_final_12$Cell)
BLA_sIPSC_final_12$Condition <- as.factor(BLA_sIPSC_final_12$Condition)
CXCL12_BLA_sIPSC_stat_all <- stat_table_exp_syn_extended(BLA_sIPSC_final_12)
CXCL12_2nM_BLA_sIPSC_stat_all <- CXCL12_BLA_sIPSC_stat_all %>% dplyr::filter(Experiment == 'CXCL12(2nM)')
CXCL12_2nM_BLA_sIPSC_stat_freq <- CXCL12_2nM_BLA_sIPSC_stat_all$Statistics[1]
CXCL12_5nM_BLA_sIPSC_stat_all <- CXCL12_BLA_sIPSC_stat_all %>% dplyr::filter(Experiment == 'CXCL12(5nM)')
CXCL12_5nM_BLA_sIPSC_stat_freq <- CXCL12_5nM_BLA_sIPSC_stat_all$Statistics[1]
```

To study whether BLA network can be regulated by CXCL12, whole-cell patch-clamp recordings were obtained from principal cells.<!--, measuring their excitability and intrinsic properties, as well as synaptic transmission.-->
The intrinsic membrane properties and synaptic transmission were measured using analogous protocols as in the CX3CL1 study. 
As assessed by gain and threshold current, no significant changes in basal excitability were found at both CXCL12 concentrations (2nM and 5nM) despite a trend toward increased excitability  (Fig. \@ref(fig:CXCL12BLAintrinsic)a).
This was especially true for CXCL12 at 5nM concentration; however, a high level of variation is observed (Fig. \@ref(fig:CXCL12BLAintrinsic)b).
Further research will be required to  independently replicate these findings and further investigate the mechanisms of this effect.
Moreover, other measured membrane intrinsic properties of principal cells were also unaffected by CXCL12 treatment, as showed in Fig. \@ref(fig:CXCl12BLAexcitabilityfigall) in Appendix \@ref(BLACXCL12membrappend)).

```{r CXCL12BLAintrinsic, fig.cap='**2nM and 5nM CXCL12 does not affect BLA excitability** **(a1-a2)** Plots presenting population data of neurons before (blue) and after(red) CXCL12 treatment as a function of the frequency and injected depolarizing current steps', fig.align = 'center', echo = FALSE, message= FALSE, echo = FALSE, warning= FALSE, message = FALSE, fig.width= 8, fig.height= 5}
# IV grouped and individual
gr_BLA_c2 <- BLA_df_final_12 %>% filter(Experiment == "CXCL12(2nM)") %>% plot_IV_group_fixed(mtitle = "CXCL12(2nM)", Sweep_min = 0, Sweep_max = 500, Div = 20)
gr_BLA_c5 <- BLA_df_final_12 %>% filter(Experiment == "CXCL12(5nM)") %>% plot_IV_group_fixed(mtitle = "CXCL12(5nM)", Sweep_min = 0, Sweep_max = 500, Div = 20)

figure1 <- ((gr_BLA_c2 | gr_BLA_c5) + plot_layout(tag_level = 'new'))

figure1
```

```{r CXCL12BLAsEPSCfreq, fig.cap='**Effects of 2nM and 5nM CXCL12 on the frequency of sEPSCs** **(a1-a2)** Plots presenting population data of neurons before (blue) and after(red) CXCL12 treatment as a function of the frequency and injected depolarizing current steps', fig.align = 'center', echo = FALSE, message= FALSE, echo = FALSE, warning= FALSE, message = FALSE, fig.width= 5, fig.height= 6}

bp_BLA_freq <- plot_boxplot(BLA_sEPSC_final_12, median_Frequency, ylabel = "sEPSC Frequency (Hz)", vary1 = 0, vary2 = 12, dot_size = 2,  mtitle = "") 
bp_BLA_freq <- bp_BLA_freq + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), strip.text = element_text(size = 11, face="bold"), strip.background = element_blank())

pie_BLA_c2_freq_sEPSC <- BLA_sEPSC_final_12 %>% filter(Experiment == 'CXCL12(2nM)') %>% plot_pie2(median_Frequency, mtitle = "CXCL12(2nM)") + theme(plot.title = element_text(size = 12, hjust = 0.5))
pie_BLA_c5_freq_sEPSC <- BLA_sEPSC_final_12 %>% filter(Experiment == 'CXCL12(5nM)') %>% plot_pie2(median_Frequency, mtitle = "CXCL12(5nM)") + theme(plot.title = element_text(size = 12, hjust = 0.5))

figure1 <- bp_BLA_freq / 
          ((pie_BLA_c2_freq_sEPSC  | pie_BLA_c5_freq_sEPSC ) + plot_layout(tag_level = 'new') + plot_layout(guides = "collect") & theme(legend.position = "bottom"))

figure1 <- figure1 + plot_annotation(tag_levels = c('a', '1'))
figure1


```

Similarly, to evaluate the potential contribution of the chemokine CXCL12 in the modulation of excitatory synaptic transmission, the frequency, amplitude, and kinetics of sEPSCs were analyzed.
As shown in Fig.\@ref(fig:CXCL12BLAsEPSCfreq), at 2nM, the reduction in the frequency of sEPSCs is observed in `r pie_BLA_c2_freq_sEPSC$data$count[1]` out of `r (pie_BLA_c2_freq_sEPSC$data$count[1] + pie_BLA_c2_freq_sEPSC$data$count[2] + pie_BLA_c2_freq_sEPSC$data$count[3])` cells following exogenous CXCL12 application, whereas this chemokine increased the excitatory transmission onto `r pie_BLA_c2_freq_sEPSC$data$count[2]` out of `r (pie_BLA_c2_freq_sEPSC$data$count[1] + pie_BLA_c2_freq_sEPSC$data$count[2] + pie_BLA_c2_freq_sEPSC$data$count[3])` neurons (Fig. \@ref(fig:CXCL12BLAsEPSCfreq)a and b1).
When all these neurons are grouped together, there is no statistically significant change in the frequency of sEPSCs (`r CXCL12_2nM_BLA_sEPSC_stat_freq`).
Similarly, when CXCL12 at a concentration of 5nM was bath-applied, `r ((pie_BLA_c2_freq_sEPSC$data$count[1]/(pie_BLA_c2_freq_sEPSC$data$count[1] + pie_BLA_c2_freq_sEPSC$data$count[2] + pie_BLA_c2_freq_sEPSC$data$count[3]))*100)`% of principal cells responded with decreased frequency of sEPSCs, while the glutamatergic synaptic transmission was increased onto `r ((pie_BLA_c2_freq_sEPSC$data$count[2]/(pie_BLA_c2_freq_sEPSC$data$count[1] + pie_BLA_c2_freq_sEPSC$data$count[2] + pie_BLA_c2_freq_sEPSC$data$count[3]))*100)`% of neurons (Fig.\@ref(fig:CXCL12BLAsEPSCfreq)a and b2, `r CXCL12_5nM_BLA_sEPSC_stat_freq`).
These findings also need further replication and investigation of the potential mechanisms underlying opposite effects of CXCL12 on sEPSCs frequency. <!--  indicating that additional opposite mechanisms were involved (although in three out of the ten neurons tested we still observed a decrease in the AP frequency)-->
The remaining data concerning excitatory synaptic transmission are illustrated in Figure \@ref(fig:CXCL12BLAsEPSCfigall) in Appendix (\@ref(BLACXCL12sEPSCappend)).

```{r CXCL12BLAsIPSCfreq, fig.cap='**Effects of 2nM and 5nM CXCL12 on the frequency and decay time of sIPSCs**', fig.align = 'center', echo = FALSE, message= FALSE, echo = FALSE, warning= FALSE, message = FALSE, fig.width= 8, fig.height= 8}

bp_BLA_freq <- plot_boxplot(BLA_sIPSC_final_12, median_Frequency, ylabel = "sIPSC Frequency (Hz)", vary1 = 0, vary2 = 6, dot_size = 2,  mtitle = "") 
bp_BLA_freq <- bp_BLA_freq + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)

bpn_BLA_freq <- plot_norm(BLA_sIPSC_final_12, median_Frequency, ylabel = "normalized \n sIPSC Frequency (%)", mtitle = "sIPSC Frequency - \n BLA") + theme(plot.title = element_text(size=14, face="bold")) #+  annotate("text", x = 'CXCL12(2nM)', y = 110, label = "p = 0.047")

pie_BLA_c2_freq <- BLA_sIPSC_final_12 %>% filter(Experiment == 'CXCL12(2nM)') %>% plot_pie2(median_Frequency, mtitle = "CXCL12(2nM)") + theme(plot.title = element_text(size = 12, hjust = 0.5))
pie_BLA_c5_freq <- BLA_sIPSC_final_12 %>% filter(Experiment == 'CXCL12(5nM)') %>% plot_pie2(median_Frequency, mtitle = "CXCL12(5nM)") + theme(plot.title = element_text(size = 12, hjust = 0.5))

#Amplitude
bp_BLA_amp <- plot_boxplot(BLA_sIPSC_final_12, median_Amplitude, ylabel = "sIPSC Amplitude (pA)", vary1 = 0, vary2 = 20, dot_size = 2,  mtitle = "") 
bp_BLA_amp <- bp_BLA_amp + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)

bpn_BLA_amp <- plot_norm(BLA_sIPSC_final_12, median_Amplitude, ylabel = "normalized \n sIPSC Amplitude (%)", mtitle = "sIPSC Amplitude - \n BLA") + theme(plot.title = element_text(size=14, face="bold")) #+  annotate("text", x = 'CXCL12(2nM)', y = 110, label = "p = 0.047")

pie_BLA_c2_amp <- BLA_sIPSC_final_12 %>% filter(Experiment == 'CXCL12(2nM)') %>% plot_pie2(median_Amplitude, mtitle = "CXCL12(2nM)") + theme(plot.title = element_text(size = 12, hjust = 0.5))
pie_BLA_c5_amp <- BLA_sIPSC_final_12 %>% filter(Experiment == 'CXCL12(5nM)') %>% plot_pie2(median_Amplitude, mtitle = "CXCL12(5nM)") + theme(plot.title = element_text(size = 12, hjust = 0.5))

# RiseTime

bp_BLA_rt <- plot_boxplot(BLA_sIPSC_final_12, median_RiseTime, ylabel = "sIPSC Rise Time (ms)", vary1 = 0, vary2 = 5, dot_size = 2,  mtitle = "") 
bp_BLA_rt <- bp_BLA_rt + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)

bpn_BLA_rt <- plot_norm(BLA_sIPSC_final_12, median_RiseTime, ylabel = "normalized \n sIPSC Rise Time (%)", mtitle = "sIPSC Rise Time - \n BLA") + theme(plot.title = element_text(size=14, face="bold")) #+  annotate("text", x = 'CXCL12(2nM)', y = 110, label = "p = 0.047")

pie_BLA_c2_rt <- BLA_sIPSC_final_12 %>% filter(Experiment == 'CXCL12(2nM)') %>% plot_pie2(median_RiseTime, mtitle = "CXCL12(2nM)") + theme(plot.title = element_text(size = 12, hjust = 0.5))
pie_BLA_c5_rt <- BLA_sIPSC_final_12 %>% filter(Experiment == 'CXCL12(5nM)') %>% plot_pie2(median_RiseTime, mtitle = "CXCL12(5nM)") + theme(plot.title = element_text(size = 12, hjust = 0.5))


# Decay Time
bp_BLA_dt <- plot_boxplot(BLA_sIPSC_final_12, median_DecayTau, ylabel = "sIPSC Decay Time (ms)", vary1 = 0, vary2 = 40, dot_size = 2,  mtitle = "") 
bp_BLA_dt <- bp_BLA_dt + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) #+  annotate("text", x = 'CXCL12(2nM)', y = 110, label = "p = 0.047")
bpn_BLA_dt <- plot_norm(BLA_sIPSC_final_12, median_DecayTau, ylabel = "normalized \n sIPSC Decay Time (%)", mtitle = "sIPSC Decay Time - \n BLA") + theme(plot.title = element_text(size=14, face="bold")) #+  annotate("text", x = 'CXCL12(2nM)', y = 110, label = "p = 0.047")
pie_BLA_c2_dt <- BLA_sIPSC_final_12 %>% filter(Experiment == 'CXCL12(2nM)') %>% plot_pie2(median_DecayTau, mtitle = "CXCL12(2nM)") + theme(plot.title = element_text(size = 12, hjust = 0.5))
pie_BLA_c5_dt <- BLA_sIPSC_final_12 %>% filter(Experiment == 'CXCL12(5nM)') %>% plot_pie2(median_DecayTau, mtitle = "CXCL12(5nM)") + theme(plot.title = element_text(size = 12, hjust = 0.5))

A <- (bp_BLA_freq | bp_BLA_rt)
B <- ((pie_BLA_c2_freq  | pie_BLA_c5_freq ) + plot_layout(tag_level = 'new') & theme(legend.position = "none"))
C <- ((pie_BLA_c2_rt | pie_BLA_c5_rt ) + plot_layout(tag_level = 'new')  + plot_layout(guides = "collect"))

lay <- "
AAAA
BBCC
"

figure1 <- wrap_plots(A = A, B=B, C=C, D=D, design = lay)
           

figure1 <- figure1 + plot_annotation(tag_levels = c('a', '1')) #+ plot_layout(heights = c(1,1,0.25)) 
figure1
```

Finally, the ability of exogenous CXCL12 to mediate inhibitory synaptic transmission was also assessed.
Although<!--similarly to excitatory transmission,--> none of the measured sIPSCs' parameters reached statistical significance, there is a trend in the frequency.
As shown in Fig.\@ref(fig:CXCL12BLAsIPSCfreq), at the concentration of 2nM, CXCL12 reduced the GABAergic transmission onto `r (pie_BLA_c2_freq$data$count[1]/(pie_BLA_c2_freq$data$count[1] + pie_BLA_c2_freq$data$count[2] + pie_BLA_c2_freq$data$count[3]))` % of principal cells.
In contrast, at 5nM, the `r pie_BLA_c5_freq$data$count[2]` out of the `r (pie_BLA_c5_freq$data$count[1] + pie_BLA_c5_freq$data$count[2] + pie_BLA_c5_freq$data$count[3])` neurons showed an increased frequency of sIPSCs. 
In addition, sIPSCs' rise time is trendily increased by both doses of CXCL12 (Fig.\@ref(fig:CXCL12BLAsIPSCfreq)b and d).
However, this multifaceted effect needs further replication and exploration.<!--The intriguing possibility that CXCL12 could modulate these functions should also be more largely explored.-->
The details and plots of the amplitude and decay time of sIPSCs' following CXCL12 treatment can be found in Appendix \@ref(BLACXCL12sIPSCappend) and Fig. \@ref(fig:CXCL12BLAsIPSCall).


```{r BLACXCL12immunostat, echo = FALSE, warning = FALSE, message= FALSE}


cxcr4_camk <-  results_immuno %>% filter(Structure == "BLA") %>% dplyr::filter(Marker1 == "cxcr4_camk") %>% dplyr::filter(Marker2 == "CaMK") 
cxcr4_camk_col <- mean(cxcr4_camk$mean_col)
cxcr4_camk_sd <- sd(cxcr4_camk$mean_col)

cxcl12_camk <-  results_immuno %>% filter(Structure == "BLA") %>% dplyr::filter(Marker1 == "cxcl12_camk") %>% dplyr::filter(Marker2 == "CaMK") 
cxcl12_camk_col <- mean(cxcl12_camk$mean_col)
cxcl12_camk_sd <- sd(cxcl12_camk$mean_col)
```


## CXCL12/CXCR4 signaling in the central amygdala

<!-- As previous studies suggest the anxiogenic action of CXCL12, its function in the CeL, critical region in relation to anxiety, was explored.
In contrast to what was observed in the basolateral amygdala, CXCL12 exerts more prominent electrophysiological effects in the central nucleus of the amygdala.-->
<!--To explore the function of neuronally expressed CXCR4, we tested its ability to modulate the electrical activity of CeL neurons.-->

### Enhanced excitability of CeL neurons following CXCL12 treatment

``` {r CXCL12CeAIVstats, echo = FALSE, message= FALSE, echo = FALSE, warning = FALSE, message = FALSE, fig.width= 18, fig.height= 18}
# getting the table of statistics for all CeA df (LF + RS) condition of one experiment
CXCL12_CeA_stat_all <- stat_table_exp_membr_extended((CeA_df_final_12))
CXCL12_CeA_stat_2nM_all <- stat_table_exp_membr_extended(CeA_df_final_12 %>% filter(Experiment == 'CXCL12(2nM)'))
CXCL12_CeA_stat_5nM_all <- stat_table_exp_membr_extended(CeA_df_final_12 %>% filter(Experiment == 'CXCL12(5nM)'))

# selecting a stat_row so it prints nicely in text
CXCL12_CeA_stat_all_gain <- as.data.frame(CXCL12_CeA_stat_all %>% dplyr::filter(Variable == 'gain') %>% dplyr::select(Statistics))
CXCL12_CeA_stat_2nM_gain <- CXCL12_CeA_stat_all_gain$Statistics[1]
CXCL12_CeA_stat_5nM_gain <- CXCL12_CeA_stat_all_gain$Statistics[2]
CXCL12_CeA_stat_amd5nM_gain <- CXCL12_CeA_stat_all_gain$Statistics[3]
CXCL12_CeA_stat_amda_gain <- CXCL12_CeA_stat_all_gain$Statistics[4]

CXCL12_CeA_stat_all_thres <- as.data.frame(CXCL12_CeA_stat_all %>% dplyr::filter(Variable == 'Threshold') %>% dplyr::select(Statistics))
CXCL12_CeA_stat_2nM_thres <- CXCL12_CeA_stat_all_thres$Statistics[1]
CXCL12_CeA_stat_5nM_thres <- CXCL12_CeA_stat_all_thres$Statistics[2]
CXCL12_CeA_stat_amd5nM_thres <- CXCL12_CeA_stat_all_thres$Statistics[3]
CXCL12_CeA_stat_amda_thres <- CXCL12_CeA_stat_all_thres$Statistics[4]

#### RS
CXCL12_CeA_stat_RS <- stat_table_exp_membr_extended((CeA_df_final_12_RS))

# selecting a stat_row so it prints nicely in text
CXCL12_CeA_stat_RS_gain <- as.data.frame(CXCL12_CeA_stat_RS %>% dplyr::filter(Variable == 'gain') %>% dplyr::select(Statistics))
CXCL12_CeA_stat_2nM_RS_gain <- CXCL12_CeA_stat_RS_gain$Statistics[1]
CXCL12_CeA_stat_5nM_RS_gain <- CXCL12_CeA_stat_RS_gain$Statistics[2]
CXCL12_CeA_stat_amd5nM_RS_gain <- CXCL12_CeA_stat_RS_gain$Statistics[3]
CXCL12_CeA_stat_amda_RS_gain <- CXCL12_CeA_stat_RS_gain$Statistics[4]

CXCL12_CeA_stat_RS_thres <- as.data.frame(CXCL12_CeA_stat_RS %>% dplyr::filter(Variable == 'Threshold') %>% dplyr::select(Statistics))
CXCL12_CeA_stat_2nM_RS_thres <- CXCL12_CeA_stat_RS_thres$Statistics[1]
CXCL12_CeA_stat_5nM_RS_thres <- CXCL12_CeA_stat_RS_thres$Statistics[2]
CXCL12_CeA_stat_amd5nM_RS_thres <- CXCL12_CeA_stat_RS_thres$Statistics[3]
CXCL12_CeA_stat_amda_RS_thres <- CXCL12_CeA_stat_RS_thres$Statistics[4]

#### LF
CXCL12_CeA_stat_LF <- stat_table_exp_membr_extended((CeA_df_final_12_LF))

# selecting a stat_row so it prints nicely in text
CXCL12_CeA_stat_LF_gain <- as.data.frame(CXCL12_CeA_stat_LF %>% dplyr::filter(Variable == 'gain') %>% dplyr::select(Statistics))
CXCL12_CeA_stat_2nM_LF_gain <- CXCL12_CeA_stat_LF_gain$Statistics[1]
CXCL12_CeA_stat_5nM_LF_gain <- CXCL12_CeA_stat_LF_gain$Statistics[2]
CXCL12_CeA_stat_amd5nM_LF_gain <- CXCL12_CeA_stat_LF_gain$Statistics[3]
CXCL12_CeA_stat_amda_LF_gain <- CXCL12_CeA_stat_LF_gain$Statistics[4]

CXCL12_CeA_stat_LF_thres <- as.data.frame(CXCL12_CeA_stat_LF %>% dplyr::filter(Variable == 'Threshold') %>% dplyr::select(Statistics))
CXCL12_CeA_stat_2nM_LF_thres <- CXCL12_CeA_stat_LF_thres$Statistics[1]
CXCL12_CeA_stat_5nM_LF_thres <- CXCL12_CeA_stat_LF_thres$Statistics[2]
CXCL12_CeA_stat_amd5nM_LF_thres <- CXCL12_CeA_stat_LF_thres$Statistics[3]
CXCL12_CeA_stat_amda_LF_thres <- CXCL12_CeA_stat_LF_thres$Statistics[4]
CXCL12_CeA_stat_fc5nM_LF_thres <- CXCL12_CeA_stat_LF_thres$Statistics[5]
```


First, to investigate the potential involvement of CXCL12 in neuronal activity in the CeL, the intrinsic firing properties of CeL neurons were assessed through whole-cell patch-clamp recordings, evoking action potentials in response to somatic current injections.<!--To evaluate the previously reported anxiety-like induced behavior triggered by CXCL12,--> 
Data reported in Figure \@ref(fig:CXCL12CeAexc) demonstrates that CXCL12, especially at a higher concentration (5nM), enhanced CeL neurons' excitability, measured as threshold current required for the first action potential and gain(slope) as a function of injected current and frequency of firing.<!--lepiej napisać///input-output curve <!--statistics, albo gain albo coś...-->
As described earlier, two main electrophysiological types of CeL neurons are Regular-Spiking and Late-Firing neurons.
Thus, further analysis revealed that although this CXCL12-induced increased firing can be observed in both types of cells (Fig. \@ref(fig:CXCL12CeAexc), right panel), it is more prominent and statistically significant in Late-Firing neurons, with threshold current during baseline being `r round(CeA_df_final_12_LF %>% filter(Experiment == 'CXCL12(5nM)' & Condition == "baseline") %>% ungroup() %>% summarize(mean(Treshold1_all)), digits = 2)` `r knitr::asis_output("\U00B1")` `r round(CeA_df_final_12_LF %>% filter(Experiment == 'CXCL12(5nM)' & Condition == "baseline") %>% ungroup() %>% dplyr::summarize(x = sd(Treshold1_all), count = n()) %>% dplyr::summarize(x/sqrt(count)), digits = 3)` and reaching `r round(CeA_df_final_12_LF %>% filter(Experiment == 'CXCL12(5nM)' & Condition == "CXCL12") %>% ungroup() %>% summarize(mean(Treshold1_all)), digits = 2)` `r knitr::asis_output("\U00B1")` `r round(CeA_df_final_12_LF %>% filter(Experiment == 'CXCL12(5nM)' & Condition == "CXCL12") %>% ungroup() %>% dplyr::summarize(x = sd(Treshold1_all), count = n()) %>% dplyr::summarize(x/sqrt(count)), digits = 3)` after CXCL12(5nM) application, n = `r CeA_df_final_12_LF %>% filter(Experiment == 'CXCL12(5nM)') %>% ungroup() %>% dplyr::select(Cell) %>% n_distinct()`, N = `r CeA_df_final_12_LF %>% filter(Experiment == 'CXCL12(5nM)') %>% group_by(Filename_all1) %>% mutate(animals = str_sub(Filename_all1, start = 1, end = 5)) %>% ungroup() %>% dplyr::select(animals) %>% n_distinct()`, `r CXCL12_CeA_stat_LF_thres$Statistics[2]`).
These effects were prevented, at least partially, by the selective CXCR4 antagonist, AMD3100 (baseline in AMD3100: `r round(CeA_df_final_12_LF %>% filter(Experiment == 'AMD3100 + \nCXCL12(5nM)' & Condition == "baseline") %>% ungroup() %>% summarize(mean(Treshold1_all)), digits = 2)` `r knitr::asis_output("\U00B1")` `r round(CeA_df_final_12_LF %>% filter(Experiment == 'AMD3100 + \nCXCL12(5nM)' & Condition == "baseline") %>% ungroup() %>% dplyr::summarize(x = sd(Treshold1_all), count = n()) %>% dplyr::summarize(x/sqrt(count)), digits = 3)`, CXCL12(5nM) in AMD3100 `r round(CeA_df_final_12_LF %>% filter(Experiment == 'AMD3100 + \nCXCL12(5nM)' & Condition == "CXCL12") %>% ungroup() %>% summarize(mean(Treshold1_all)), digits = 2)` `r knitr::asis_output("\U00B1")` `r round(CeA_df_final_12_LF %>% filter(Experiment == 'AMD3100 + \nCXCL12(5nM)' & Condition == "CXCL12") %>% ungroup() %>% dplyr::summarize(x = sd(Treshold1_all), count = n()) %>% dplyr::summarize(x/sqrt(count)), digits = 3)`, n = `r CeA_df_final_12_LF %>% filter(Experiment == 'AMD3100 + \nCXCL12(5nM)') %>% ungroup() %>% dplyr::select(Cell) %>% n_distinct()`, N = `r CeA_df_final_12_LF %>% filter(Experiment == 'AMD3100 + \nCXCL12(5nM)') %>% group_by(Filename_all1) %>% mutate(animals = str_sub(Filename_all1, start = 1, end = 5)) %>% ungroup() %>% dplyr::select(animals) %>% n_distinct()`, `r CXCL12_CeA_stat_amd5nM_LF_thres`).
Of note, the application of AMD3100 alone led to an opposite trend (from `r round(CeA_df_final_12_LF %>% filter(Experiment == 'AMD3100' & Condition == "baseline") %>% ungroup() %>% summarize(mean(Treshold1_all)), digits = 2)` `r knitr::asis_output("\U00B1")` `r round(CeA_df_final_12_LF %>% filter(Experiment == 'AMD3100' & Condition == "baseline") %>% ungroup() %>% dplyr::summarize(x = sd(Treshold1_all), count = n()) %>% dplyr::summarize(x/sqrt(count)), digits = 3)` to `r round(CeA_df_final_12_LF %>% filter(Experiment == 'AMD3100' & Condition == "AMD3100") %>% ungroup() %>% summarize(mean(Treshold1_all)), digits = 2)` `r knitr::asis_output("\U00B1")` `r round(CeA_df_final_12_LF %>% filter(Experiment == 'AMD3100' & Condition == "AMD3100") %>% ungroup() %>% dplyr::summarize(x = sd(Treshold1_all), count = n()) %>% dplyr::summarize(x/sqrt(count)), digits = 3)`, n = `r CeA_df_final_12_LF %>% filter(Experiment == 'AMD3100') %>% ungroup() %>% dplyr::select(Cell) %>% n_distinct()`, N = `r CeA_df_final_12_LF %>% filter(Experiment == 'AMD3100') %>% group_by(Filename_all1) %>% mutate(animals = str_sub(Filename_all1, start = 1, end = 5)) %>% ungroup() %>% dplyr::select(animals) %>% n_distinct()`,`r CXCL12_CeA_stat_amda_LF_thres`, Fig.\@ref(fig:CXCL12CeAexc), right panel). 
These findings suggest that CXCR4 may be involved in the regulation of firing of Late-Firing neurons and possibly its tonic activity in those cells. 

Given that several studies documented the presence of CXCR4 in astrocytes [@bezzi_2001; @bonavia_2003; @cal_2010], it was investigated whether the blockade of these glial cells by incubation in astrocytic toxin, fluorocitrate, would eliminate the observed CXCL12-mediated increase in Late-Firing neurons excitability. 
This effect was not abolished by astrocytic inactivation in an acute brain slice (`r CXCL12_CeA_stat_fc5nM_LF_thres`), raising the possibility that CXCL12 might activate CXCR4 directly on Late-Firing neurons, enhancing the excitability of these neurons.
Notably, this observation is based on a limited number of neurons (n = `r CeA_df_final_12_LF %>% filter(Experiment == 'fluorocitrate + \nCXCL12(5nM)') %>% ungroup() %>% dplyr::select(Cell) %>% n_distinct()`, N = `r CeA_df_final_12_LF %>% filter(Experiment == 'fluorocitrate + \nCXCL12(5nM)') %>% group_by(Filename_all1) %>% mutate(animals = str_sub(Filename_all1, start = 1, end = 5)) %>% ungroup() %>% dplyr::select(animals) %>% n_distinct()`) and, therefore, this finding needs further replication.<!-- XE991 also enhanced  the  excitability  of  the  cell,  i.e.  increased  the  number  of  APs  evoked  by  a  constant depolarizing current pulse, reduced their rate of adaptation, enhanced the afterdepolarization and promoted bursting. // There  were  no  clear  differences  in  the  passive  membrane properties in cells showing different degrees of spike frequency adaptation. These  measurements  have  therefore  been  lumped together. -->
 
In addition, despite CXCL12-induced enhancement in CeL neurons' excitability, CXCL12 does not modulate any other membrane properties in those neurons, indicating a rather presynaptic mechanism. 
Figures and detailed descriptions can be found in Appendix \@ref(CXCL12CeAmembr). 
Together, these findings illustrate that CXCL12 upregulated LF neurons' excitability in the CeL in a CXCR4-dependent and probably astrocytic-independent manner.


```{r CXCL12CeAexc, fig.cap='**CXCL12 enhanced excitability of CeL neurons** **(a1)** Boxplots showing a gain of each cell before and after CXCL12 application in Regular-Spiking neurons. **(a2)** Boxplots showing a gain of each cell before and after CXCL12 application in Late-Firing neurons across different conditions. **(b1)** Boxplots showing threshold current of each cell before and after CXCL12 application in Regular-Spiking neurons. **(b2)** Boxplots showing threshold current of each cell before and after CXCL12 application in Late-Firing neurons across different conditions./// **(c1)** Input-Output relationship of a representative neuron illustrating its excitability before (baseline) and after CX3CL1 treatment. **(c2)** Voltage traces from the same representative cells. They represent the highlighted by orange dots from previous plot. **(d1)** Input-Output relationship of a representative neuron illustrating its excitability before (baseline) and after CX3CL1 treatment in the presence of AZD8797, the blocker of CX3CL1 receptor. **(d2)** Voltage traces from the same representative cells. They represent the highlighted by orange dots from previous plot. **(e1)** Input-Output relationship of a representative neuron illustrating its excitability before (baseline) and after CX3CL1 treatment in the presence of minocycline, the blocker of microglial activity. **(d2)** Voltage traces from the same representative cells. They represent the highlighted by orange dots from previous plot. Scale bar: 10mV, 100ms', fig.align = 'center', echo = FALSE, message= FALSE, warning= FALSE, fig.width= 12, fig.height= 10}

#knitr::include_graphics("images/results//CX3CL1_BLA_excitability.png")
#knitr::include_graphics("images/results//CX3CL1_BLA_excitability.png")

inset_frak2nM <- image_read("images//results//inset_frak2nM.png")
inset_frak2nM <- image_ggplot(inset_frak2nM)
inset_azdfrak2nM <- image_read("images//results//inset_azdfrak2nM.png")
inset_azdfrak2nM <- image_ggplot(inset_azdfrak2nM)
inset_azda <- image_read("images//results//inset_azd.png")
inset_azda <- image_ggplot(inset_azda)
inset_minofrak2nM <- image_read("images//results//inset_minofrak2nM.png")
inset_minofrak2nM <- image_ggplot(inset_minofrak2nM)
inset_minoa <- image_read("images//results//inset_minoa.png")
inset_minoa <- image_ggplot(inset_minoa)

## subsetting only CX3CL1 conditions
CeA_cxcl12_df_final_sub <- CeA_df_final_12 %>% dplyr::filter(Experiment %in% c("CXCL12(2nM)", "CXCL12(5nM)"))
CeA_cxcl12_df_final_sub_RS <- CeA_df_final_12_RS %>% dplyr::filter(Experiment %in% c("CXCL12(2nM)", "CXCL12(5nM)"))
CeA_cxcl12_df_final_sub_LF <- CeA_df_final_12_LF %>% dplyr::filter(Experiment %in% c("CXCL12(2nM)", "CXCL12(5nM)", "AMD3100 + \nCXCL12(5nM)", "AMD3100", "fluorocitrate + \nCXCL12(5nM)"))

# GAIN
bp_CeA_cxcl12_gain <- plot_boxplot(CeA_cxcl12_df_final_sub, gain, mtitle= "CeL neurons", ylabel = "gain", vary1 = 0, vary2 = 0.3, dot_size = 2)
bp_CeA_cxcl12_gain <- bp_CeA_cxcl12_gain + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),
 strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE,  size = 10, face = "bold", label.y = 0.15)

bp_CeA_cxcl12_gain_LF <- plot_boxplot(CeA_cxcl12_df_final_sub_LF, gain, mtitle= "Late-Firing \nneurons", ylabel = "gain", vary1 = 0, vary2 = 0.3, dot_size = 2)
bp_CeA_cxcl12_gain_LF <- bp_CeA_cxcl12_gain_LF + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),
 strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE,  size = 10, face = "bold", label.y = 0.15)

bp_CeA_cxcl12_gain_RS <- plot_boxplot(CeA_cxcl12_df_final_sub_RS, gain, mtitle= "Regular-Spiking \nneurons", ylabel = "gain", vary1 = 0, vary2 = 0.3, dot_size = 2)
bp_CeA_cxcl12_gain_RS <- bp_CeA_cxcl12_gain_RS + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),
 strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE,  size = 10, face = "bold", label.y = 0.15)

# Threshold
bp_CeA_cxcl12_thres <- plot_boxplot(CeA_cxcl12_df_final_sub, Treshold1_all, mtitle= "CeL neurons", ylabel = "Threshold current (mV)", vary1 = -60, vary2 = -10, dot_size = 2)
bp_CeA_cxcl12_thres <- bp_CeA_cxcl12_thres + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),
 strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE,  size = 10, face = "bold", label.y = -25)

bp_CeA_cxcl12_thres_LF <- plot_boxplot(CeA_cxcl12_df_final_sub_LF, Treshold1_all, mtitle= "Late-Firing \nneurons", ylabel = "Threshold current (mV)", vary1 = -60, vary2 = -10, dot_size = 2)
bp_CeA_cxcl12_thres_LF <- bp_CeA_cxcl12_thres_LF + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),
 strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE,  size = 10, face = "bold", label.y = -25)

bp_CeA_cxcl12_thres_RS <- plot_boxplot(CeA_cxcl12_df_final_sub_RS, Treshold1_all, mtitle= "Regular-Spiking \nneurons", ylabel = "Threshold current (mV)", vary1 = -60, vary2 = -10, dot_size = 2)
bp_CeA_cxcl12_thres_RS <- bp_CeA_cxcl12_thres_RS + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),
 strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE,  size = 10, face = "bold", label.y = -25)

### making representative plots 
## cxcl12
#frak2nM_IV_subset <- CeA_df_final %>% filter(Experiment == "CX3CL1(2nM)" & Cell %in% c(20)) # subtracting one representative cell from whole dataframe
#frak2nM_IV_subset$Filename_all1[frak2nM_IV_subset$Filename_all1 == "21303018"] = "" #renaming the name - instead the name of the file - the name of the condition
#representative_frak2nM <- frak2nM_IV_subset %>% plot_IV_individual(mtitle = "") + theme(strip.text = element_text(size = 11, face="bold"), strip.background = element_blank(), plot.margin = unit(c(0.25,0.25,0.25,0.25), "cm")) # making a plot
# ## importing traces  
# 

# 
#powinny być nowe IV_representative_minoa <- fig("images//results//IV_representative_minoa.png", aspect.ratio = "free", b_pos = "inside", b_size = 0, b_margin =  ggplot2::margin(0, 0, 0, 0))
#traces_frak2nM <- fig("images//results//CX3CL1_CeA_IV_traces_frak2nM.png", aspect.ratio = "free", b_pos = "inside", b_size = 0, b_margin =  ggplot2::margin(0, 0, 0, 0))

### general representative IV figure
#figure_IV <- representative_frak2nM | representative_azdfrak2nM | representative_minofrak2nM

#using patchwork to do layout of the figure

A <- ((bp_CeA_cxcl12_gain_RS | bp_CeA_cxcl12_gain_LF) + plot_layout(tag_level = "new", widths = c(0.5, 1.5)))
B <- ((bp_CeA_cxcl12_thres_RS | bp_CeA_cxcl12_thres_LF) + plot_layout(tag_level = "new", widths = c(0.5,  1.5)))
#C <- (((representative_frak2nM +  ggtitle('CX3CL1(2nM)'))| traces_frak2nM) + plot_layout(tag_level = "new", widths = c(0.5,1))) 
#D <- (((representative_azdfrak2nM +  ggtitle('AZD8797 + CX3CL1(2nM)'))| traces_azdfrak) + plot_layout(tag_level = "new", widths = c(0.5,1))) 
#E <- (((representative_minofrak2nM +  ggtitle('minocycline + CX3CL1(2nM)')) | traces_minofrak) + plot_layout(tag_level = "new", widths = c(0.5,1))) 

des <- "
AAA
BBB
"

fig2 <- wrap_plots(A = A, B= B, design = des) #,  C = C, D = D, E = E


fig2 <- fig2 + plot_annotation(tag_levels = c('a', '1'))
fig2

```


### Complex actions of CXCL12 on excitatory synaptic transmission

```{r CXCL12CeAsEPSCstat, echo = FALSE, message= FALSE, echo = FALSE, warning= FALSE, message = FALSE, fig.width= 15, fig.height= 18}

CeA_sEPSC_all_subset <-CeA_sEPSC_final_12 %>% dplyr::filter(Experiment %in% c("CXCL12(2nM)", "CXCL12(5nM)"))
CeA_sEPSC_LF_subset <-CeA_sEPSC_LF_12 %>% dplyr::filter(Experiment %in% c("CXCL12(2nM)", "CXCL12(5nM)"))
CeA_sEPSC_RS_subset <-CeA_sEPSC_RS_12 %>% dplyr::filter(Experiment %in% c("CXCL12(2nM)", "CXCL12(5nM)"))


# getting the table of statistics for all CeA df (LF + RS) condition of one experiment
CeA_CXCL12_sEPSC_stat_all <- stat_table_exp_syn_extended((CeA_sEPSC_all_subset))
CeA_CXCL12_sEPSC_stat_RS <- stat_table_exp_syn_extended((CeA_sEPSC_RS_subset))
CeA_CXCL12_sEPSC_stat_LF <- stat_table_exp_syn_extended((CeA_sEPSC_LF_subset))

#CeA_CX3CL1_sIPSC_stat_LF_freq <- as.data.frame(CeA_CX3CL1_sIPSC_stat_LF %>% dplyr::filter(Variable == 'median_Frequency') %>% dplyr::select(Statistics))
#CeA_CX3CL1_sIPSC_stat_LF_frak2nM_freq <- CeA_CX3CL1_sIPSC_stat_LF_freq$Statistics[1]

```

As presented in this dissertation, enhancement of excitability of CeL cells, mainly Late-Firing neurons, triggered by CXCL12 was not accompanied by any other measured membrane parameters, such as the input resistance (see Fig. \@ref(fig:CXCl12CeAmembrfigall1) in Appendix \@ref(CXCL12CeAmembr)).
Thus, it may be speculated that rather than the involvement of any channel, this effect is a result of upregulated glutamatergic activity onto CeL neurons.<!--better written-->
To test this hypothesis, spontaneous excitatory synaptic transmission was investigated. 
When all CeL neurons are grouped into one category, no differences in the frequency, amplitude, and kinetics of sEPSCs are observed between baseline and CXCL12 treatment (\@ref(fig:CXCL12CeAsEPSC), left panel).
CXCL12 also did not enhance the glutamatergic transmission onto Late-Firing neurons (\@ref(fig:CXCL12CeAsEPSC), right panel).
Intriguingly, regarding excitatory synaptic transmission onto Regular-Firing neurons, two opposing trends (decreased vs. increased frequency of sEPSCs) were revealed depending on the concentration of CXCL12 used (2nM vs. 5nM; see Fig. (\@ref(fig:CXCL12CeAsEPSC)a2)).<!--the concentration of 5nM follow different trends  a  trend  for opposing CXCL12 action based on different concentration was revealed // These two opposite effects (slowing vs. acceleration) were observed in a same neuron depending on the concentration of SDF-1 a used ( n ¼ 6, Fig. 4A), but some neurons presented either the slowing or the acceleration effect (Fig. 4C and D, left panels). Thus, we hypothesized that these dose-dependant effects were mediated through different mechanisms. CXCL12 often appears to have opposite effects on neuronal function depending on the concentration.-->
However, none of these effects reached statistical significance.
Nevertheless, several reports indicated the opposing effects of CXCL12 on neuronal function depending on the concentration, and thereby this issue warrants further investigation. 
Several mechanisms for these opposite effects are reviewed in @guyon_2007.
A detailed summary of measured parameters of excitatory synaptic transmission together with Figure illustrating the amplitude and kinetics of sEPSCs after CXCL12 treatment can be found in Table <!-- --> in Appendix \@ref(CXCL12CeAsEPSCappend).


```{r CXCL12CeAsEPSC, fig.cap='**Opposing effects of CXCL12 on excitatory synaptic transmission in CeL** **(a1)** Boxplots showing the frequency of sEPSCs before and after CXCL12 treatment in Regular-Spiking neurons. **(a2)** Boxplots showing the frequency of sEPSCs before and after CXCL12 treatment in Late-Firing neurons. **b1-4** Pie charts illustrating the number of neurons responding differently to CXCL12 application in relation to their electrophysiological firing pattern and CXCL12 concentration', fig.align = 'center', echo = FALSE, message= FALSE, echo = FALSE, warning= FALSE, message = FALSE, fig.height= 8, fig.width= 8}
#knitr::include_graphics("images/results//CX3CL1_BLA_excitability.png")
#knitr::include_graphics("images/results//CX3CL1_BLA_excitability.png")

# loading needed subsets 

# making boxplots with facets
bp_CeA_sEPSC_cxcl12_all_freq <- plot_boxplot(CeA_sEPSC_all_subset, median_Frequency, ylabel = "sEPSC Frequency (Hz)", vary1 = 0, vary2 = 5, dot_size = 2,  mtitle = "CeL neurons") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5)) 

bp_CeA_sEPSC_cxcl12_all_freq  <- bp_CeA_sEPSC_cxcl12_all_freq  + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 14, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),  strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE, size = 8, label.y = 4) 

bp_CeA_sEPSC_cxcl12_LF_freq <- plot_boxplot(CeA_sEPSC_LF_subset, median_Frequency, ylabel = "sEPSC Frequency (Hz)", vary1 = 0, vary2 = 5, dot_size = 2,  mtitle = "Late-Firing \nneurons") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5)) 

bp_CeA_sEPSC_cxcl12_LF_freq  <- bp_CeA_sEPSC_cxcl12_LF_freq  + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 14, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),  strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE, size = 8, label.y = 4) 

bp_CeA_sEPSC_cxcl12_RS_freq <- plot_boxplot(CeA_sEPSC_RS_subset, median_Frequency, ylabel = "sEPSC Frequency (Hz)", vary1 = 0, vary2 = 5, dot_size = 2,  mtitle = "Regular-Spiking \nneurons") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5)) 

bp_CeA_sEPSC_cxcl12_RS_freq  <- bp_CeA_sEPSC_cxcl12_RS_freq  + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 14, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),  strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE, size = 8, label.y = 4) 

pie_RS_c2_freq <- CeA_sEPSC_RS_subset %>% filter(Experiment == 'CXCL12(2nM)') %>% plot_pie2(median_Frequency, mtitle = "CXCL12(2nM) - \nRegular-Spiking neurons") + theme(plot.title = element_text(size = 12, hjust = 0.5))
pie_RS_c5_freq <- CeA_sEPSC_RS_subset %>% filter(Experiment == 'CXCL12(5nM)') %>% plot_pie2(median_Frequency, mtitle = "CXCL12(5nM) - \nRegular-Spiking neurons") + theme(plot.title = element_text(size = 12, hjust = 0.5))

pie_LF_c2_freq <- CeA_sEPSC_LF_subset %>% filter(Experiment == 'CXCL12(2nM)') %>% plot_pie2(median_Frequency, mtitle = "CXCL12(2nM) - \nLate-Firing neurons") + theme(plot.title = element_text(size = 12, hjust = 0.5))
pie_LF_c5_freq <- CeA_sEPSC_LF_subset %>% filter(Experiment == 'CXCL12(5nM)') %>% plot_pie2(median_Frequency, mtitle = "CXCL12(5nM) - \nLate-Firing neurons") + theme(plot.title = element_text(size = 12, hjust = 0.5))

#using patchwork to do layout of the figure
A <- (bp_CeA_sEPSC_cxcl12_RS_freq | bp_CeA_sEPSC_cxcl12_LF_freq) + plot_layout(tag_level = "new")
B <-  (pie_RS_c2_freq | pie_RS_c5_freq | pie_LF_c2_freq | pie_LF_c5_freq) + plot_layout(tag_level = "new") +  plot_layout(guides = "collect") & theme(legend.position = "bottom")
# C <- (bp_CeA_sEPSC_cxcl12_all_rt| bp_CeA_sEPSC_cxcl12_RS_rt | bp_CeA_sEPSC_cxcl12_LF_rt) + plot_layout(tag_level = "new")
# D <-  (bp_CeA_sEPSC_cxcl12_all_dt| bp_CeA_sEPSC_cxcl12_RS_dt | bp_CeA_sEPSC_cxcl12_LF_dt) + plot_layout(tag_level = "new")

# C <- (((traces_frak2nM +  ggtitle('CX3CL1(2nM)')) | (traces_azdfrak + ggtitle('AZD8797 + CX3CL1(2nM)')) | (traces_minofrak + ggtitle('minocycline + CX3CL1(2nM)')) + plot_layout(tag_level = "new")))

lay <- "
AAAA
BBBB
"

figure1 <- wrap_plots(A = A, B = B, design = lay)

figure1 <- figure1 + plot_annotation(tag_levels = c('a', '1'))


figure1

```

### CXCL12 modulate inhibitory synaptic transmission in the central nucleus of the amygdala

```{r CXCL12CeAsIPSCstat, echo = FALSE, message= FALSE, echo = FALSE, warning= FALSE, message = FALSE, fig.width= 15, fig.height= 18}

CeA_mIPSC_final_12$Experiment <- plyr::revalue(CeA_mIPSC_final_12$Experiment, c('CXCL12(2nM)' = 'TTX + \nCXCL12(2nM)', 'CXCL12(5nM)' = 'TTX + \nCXCL12(5nM)'))
CeA_mIPSC_final_12$Condition <- as.factor(CeA_mIPSC_final_12$Condition)
CeA_mIPSC_final_12_RS <- CeA_mIPSC_final_12 %>% dplyr::filter(Type == 'RS')
CeA_mIPSC_final_12_LF <- CeA_mIPSC_final_12 %>% dplyr::filter(Type == 'LF')

CeA_sIPSC_all_subset <-CeA_sIPSC_final_12 %>% dplyr::filter(Experiment %in% c("CXCL12(2nM)", "CXCL12(5nM)"))
#CeA_sIPSC_all_subset <- CeA_sIPSC_all_subset %>% dplyr::bind_rows(CeA_mIPSC_final_12)
CeA_sIPSC_LF_subset1 <- CeA_sIPSC_LF_12
CeA_sIPSC_LF_subset1 <- CeA_sIPSC_LF_subset1 %>% dplyr::bind_rows(CeA_mIPSC_final_12_LF)
CeA_sIPSC_LF_subset <- CeA_sIPSC_LF_subset1 %>% dplyr::filter(Experiment %in% c("CXCL12(2nM)", "CXCL12(5nM)", "AMD3100 + \nCXCL12(5nM)", "AMD3100", "fluorocitrate + \nCXCL12(5nM)", "TTX + \nCXCL12(5nM)"))

CeA_sIPSC_RS_subset1 <-CeA_sIPSC_RS_12
CeA_sIPSC_RS_subset1 <- CeA_sIPSC_RS_subset1 %>% dplyr::bind_rows(CeA_mIPSC_final_12_RS)
CeA_sIPSC_RS_subset <- CeA_sIPSC_RS_subset1 %>% dplyr::filter(Experiment %in% c("CXCL12(2nM)", "CXCL12(5nM)", "AMD3100 + \nCXCL12(5nM)", "AMD3100", "fluorocitrate + \nCXCL12(5nM)", "TTX + \nCXCL12(5nM)"))


# getting the table of statistics
CeA_sIPSC_all_stats <- stat_table_exp_syn_extended(CeA_sIPSC_all_subset)
CeA_sIPSC_LF_stats <- stat_table_exp_syn_extended(CeA_sIPSC_LF_subset)
CeA_sIPSC_RS_stats <- stat_table_exp_syn_extended(CeA_sIPSC_RS_subset)
# selecting a stat_row so it prints nicely in text

CeA_sIPSC_all_stats_amp <- as.data.frame(CeA_sIPSC_all_stats %>% dplyr::filter(Variable == 'median_Amplitude'))
CeA_sIPSC_all_stats_amp_2nM <- CeA_sIPSC_all_stats_amp$Statistics[1]
CeA_sIPSC_all_stats_amp_5nM <- CeA_sIPSC_all_stats_amp$Statistics[2]



CeA_sIPSC_LF_stats_amp <- as.data.frame(CeA_sIPSC_LF_stats %>% dplyr::filter(Variable == 'median_Amplitude'))
CeA_sIPSC_LF_stats_amp_5nM <- CeA_sIPSC_LF_stats_amp$Statistics[2]
CeA_sIPSC_LF_stats_amp_amd5nM <- CeA_sIPSC_LF_stats_amp$Statistics[3]
CeA_sIPSC_LF_stats_amp_fluoro5nM <- CeA_sIPSC_LF_stats_amp$Statistics[5]
CeA_sIPSC_LF_stats_amp_ttx5nM <- CeA_sIPSC_LF_stats_amp$Statistics[6]

CeA_sIPSC_LF_stats_freq <- as.data.frame(CeA_sIPSC_LF_stats %>% dplyr::filter(Variable == 'median_Frequency'))
CeA_sIPSC_LF_stats_freq_5nM <- CeA_sIPSC_LF_stats_freq$Statistics[2]
CeA_sIPSC_LF_stats_freq_amd5nM <- CeA_sIPSC_LF_stats_freq$Statistics[3]
CeA_sIPSC_LF_stats_freq_fluoro5nM <- CeA_sIPSC_LF_stats_freq$Statistics[5]
CeA_sIPSC_LF_stats_freq_ttx5nM <- CeA_sIPSC_LF_stats_freq$Statistics[6]


CeA_sIPSC_RS_stats_freq <- as.data.frame(CeA_sIPSC_RS_stats %>% dplyr::filter(Variable == 'median_Frequency'))
CeA_sIPSC_RS_stats_freq_5nM <- CeA_sIPSC_RS_stats_freq$Statistics[2]
CeA_sIPSC_RS_stats_freq_amd5nM <- CeA_sIPSC_RS_stats_freq$Statistics[3]
CeA_sIPSC_RS_stats_freq_fluoro5nM <- CeA_sIPSC_RS_stats_freq$Statistics[5]
CeA_sIPSC_RS_stats_freq_ttx5nM <- CeA_sIPSC_RS_stats_freq$Statistics[6]
#CeA_CX3CL1_sIPSC_stat_LF_freq <- as.data.frame(CeA_CX3CL1_sIPSC_stat_LF %>% dplyr::filter(Variable == 'median_Frequency') %>% dplyr::select(Statistics))
#CeA_CX3CL1_sIPSC_stat_LF_frak2nM_freq <- CeA_CX3CL1_sIPSC_stat_LF_freq$Statistics[1]

```

Considering that CeL neurons are mostly GABAergic and highly interconnected (see Introduction \@ref(CeA)), CXCL12-triggered enhancement in their excitability may thereby impact the inhibitory synaptic transmission.
To test this hypothesis, the frequency, amplitude, and kinetics of sIPSCs were recorded using whole-cell patch-clamp recordings. 
As expected, the application of CXCL12 on brain slices significantly changed the frequency and amplitude of spontaneous inhibitory synaptic transmission (Figs. \@ref(fig:CXCL12CeAsIPSCRS) and \@ref(fig:CXCL12CeAsIPSCLF)).
Analysis, which divided cells into two subgroups based on their electrophysiological types, revealed that CXCL12 at the concentration of 5nM differentially regulated inhibitory synaptic transmission in the CeL. 

Specifically, CXCL12 enhanced the GABAergic transmission onto Regular-Spiking neurons, as manifested by increased frequency of sIPSCs from `r round(CeA_sIPSC_RS_subset %>% filter(Experiment == 'CXCL12(5nM)' & Condition == "baseline") %>% ungroup() %>% summarize(mean(median_Frequency)), digits = 2)` `r knitr::asis_output("\U00B1")` `r round(CeA_sIPSC_RS_subset %>% filter(Experiment == 'CXCL12(5nM)' & Condition == "baseline") %>% ungroup() %>% dplyr::summarize(x = sd(median_Frequency), count = n()) %>% dplyr::summarize(x/sqrt(count)), digits = 3)` to `r round(CeA_sIPSC_RS_subset  %>% filter(Experiment == 'CXCL12(5nM)' & Condition == "CXCL12") %>% ungroup() %>% summarize(mean(median_Frequency)), digits = 2)` `r knitr::asis_output("\U00B1")` `r round(CeA_sIPSC_RS_subset %>% filter(Experiment == 'CXCL12(5nM)' & Condition == "CXCL12") %>% ungroup() %>% dplyr::summarize(x = sd(median_Frequency), count = n()) %>% dplyr::summarize(x/sqrt(count)), digits = 3)` Hz (n = `r CeA_sIPSC_RS_subset %>% filter(Experiment == 'CXCL12(5nM)') %>% ungroup() %>% dplyr::select(Cell) %>% n_distinct()`, N = `r CeA_sIPSC_RS_subset %>% filter(Experiment == 'CXCL12(5nM)') %>% group_by(Filename) %>% mutate(animals = str_sub(Filename, start = 1, end = 5)) %>% ungroup() %>% dplyr::select(animals) %>% n_distinct()`, `r CeA_sIPSC_RS_stats_freq_5nM`, Fig.\@ref(fig:CXCL12CeAsIPSCRS)a1), 
without any changes in the amplitude (baseline: `r round(CeA_sIPSC_RS_subset %>% filter(Experiment == 'CXCL12(5nM)' & Condition == "baseline") %>% ungroup() %>% summarize(mean(median_Amplitude)), digits = 2)` `r knitr::asis_output("\U00B1")` `r round(CeA_sIPSC_RS_subset %>% filter(Experiment == 'CXCL12(5nM)' & Condition == "baseline") %>% ungroup() %>% dplyr::summarize(x = sd(median_Amplitude), count = n()) %>% dplyr::summarize(x/sqrt(count)), digits = 3)` pA, CXCL12(5nM): `r round(CeA_sIPSC_RS_subset  %>% filter(Experiment == 'CXCL12(5nM)' & Condition == "CXCL12") %>% ungroup() %>% summarize(mean(median_Amplitude)), digits = 2)` `r knitr::asis_output("\U00B1")` `r round(CeA_sIPSC_RS_subset %>% filter(Experiment == 'CXCL12(5nM)' & Condition == "CXCL12") %>% ungroup() %>% dplyr::summarize(x = sd(median_Amplitude), count = n()) %>% dplyr::summarize(x/sqrt(count)), digits = 3)` pA, `r CeA_sIPSC_RS_stats_freq_5nM` Fig.\@ref(fig:CXCL12CeAsIPSCRS)a2).
To  confirm that the CXCL12 receptor, CXCR4, is  responsible  for modulation of GABAergic transmission in RS neurons, the CXCR4 receptor antagonist, AMD3100, was employed.
As expected, AMD3100 eliminated the CXCL12-induced increase in the frequency of sIPSC, with `r round(CeA_sIPSC_RS_subset %>% filter(Experiment == 'AMD3100 + \nCXCL12(5nM)' & Condition == "baseline") %>% ungroup() %>% summarize(mean(median_Frequency)), digits = 2)` `r knitr::asis_output("\U00B1")` `r round(CeA_sIPSC_RS_subset %>% filter(Experiment == 'AMD3100 + \nCXCL12(5nM)' & Condition == "baseline") %>% ungroup() %>% dplyr::summarize(x = sd(median_Frequency), count = n()) %>% dplyr::summarize(x/sqrt(count)), digits = 3)` in baseline
and `r round(CeA_sIPSC_RS_subset %>% filter(Experiment == 'AMD3100 + \nCXCL12(5nM)' & Condition == 'CXCL12') %>% ungroup() %>% summarize(mean(median_Frequency)), digits = 2)` `r knitr::asis_output("\U00B1")` `r round(CeA_sIPSC_RS_subset %>% filter(Experiment == 'AMD3100 + \nCXCL12(5nM)' & Condition == 'CXCL12') %>% ungroup() %>% dplyr::summarize(x = sd(median_Frequency), count = n()) %>% dplyr::summarize(x/sqrt(count)), digits = 3)` after CXCL12 treatment (`r CeA_sIPSC_RS_stats_freq_amd5nM`, n = `r CeA_sIPSC_RS_subset %>% filter(Experiment == 'AMD3100 + \nCXCL12(5nM)') %>% ungroup() %>% dplyr::select(Cell) %>% n_distinct()`, N = `r CeA_sIPSC_RS_subset %>% filter(Experiment == 'AMD3100 + \nCXCL12(5nM)') %>% group_by(Filename) %>% mutate(animals = str_sub(Filename, start = 1, end = 5)) %>% ungroup() %>% dplyr::select(animals) %>% n_distinct()`, Fig.\@ref(fig:CXCL12CeAsIPSCRS)b2).<!-- czy na pewno poprawnie?-->
Since CXCR4 is well-known to be functionally expressed on astrocytes<!--citation?-->, the possible involvement of astrocytes in mediating CXCL12-induced enhancement of GABAergic transmission onto Regular-Spiking neurons was investigated.
For this reason, prior to CXCL12 treatment, the brain slices were pretreated with fluorocitrate, a toxin known to inhibit astrocytic metabolism.
As shown in Fig. \@ref(fig:CXCL12CeAsIPSCRS)b3, fluorocitrate prevented the CXCL12-triggered increase in the frequency of sIPSCs (<!-- % of baseline? -->`r CeA_sIPSC_RS_stats_freq_fluoro5nM`, n = `r CeA_sIPSC_RS_subset %>% filter(Experiment == 'fluorocitrate + \nCXCL12(5nM)') %>% ungroup() %>% dplyr::select(Cell) %>% n_distinct()`, N = `r CeA_sIPSC_RS_subset %>% filter(Experiment == 'fluorocitrate + \nCXCL12(5nM)') %>% group_by(Filename) %>% mutate(animals = str_sub(Filename, start = 1, end = 5)) %>% ungroup() %>% dplyr::select(animals) %>% n_distinct()`).

To determine whether there was a direct effect of CXCL12 on GABAergic terminals, the miniature IPSCs (mIPSCs) were recorded.
In these experiments, TTX was used to block the action potentials. 
Under these conditions, the modulation of GABAergic transmission by CXCL12 was partially abolished (mIPSC frequency during baseline:  `r round(CeA_sIPSC_RS_subset %>% filter(Experiment == 'TTX + \nCXCL12(5nM)' & Condition == "baseline") %>% ungroup() %>% summarize(mean(median_Frequency)), digits = 2)` `r knitr::asis_output("\U00B1")` `r round(CeA_sIPSC_RS_subset %>% filter(Experiment == 'TTX + \nCXCL12(5nM)' & Condition == "baseline") %>% ungroup() %>% dplyr::summarize(x = sd(median_Frequency), count = n()) %>% dplyr::summarize(x/sqrt(count)), digits = 3)` vs. mIPSC frequency after CXCL12 application: `r round(CeA_sIPSC_RS_subset %>% filter(Experiment == 'TTX + \nCXCL12(5nM)' & Condition == 'CXCL12') %>% ungroup() %>% summarize(mean(median_Frequency)), digits = 2)` `r knitr::asis_output("\U00B1")` `r round(CeA_sIPSC_RS_subset %>% filter(Experiment == 'TTX + \nCXCL12(5nM)' & Condition == 'CXCL12') %>% ungroup() %>% dplyr::summarize(x = sd(median_Frequency), count = n()) %>% dplyr::summarize(x/sqrt(count)), digits = 3)`, `r CeA_sIPSC_RS_stats_freq_ttx5nM`, n = `r CeA_sIPSC_RS_subset %>% filter(Experiment == 'TTX + \nCXCL12(5nM)') %>% ungroup() %>% dplyr::select(Cell) %>% n_distinct()`, N = `r CeA_sIPSC_RS_subset %>% filter(Experiment == 'TTX + \nCXCL12(5nM)') %>% group_by(Filename) %>% mutate(animals = str_sub(Filename, start = 1, end = 5)) %>% ungroup() %>% dplyr::select(animals) %>% n_distinct()`, Fig. \@ref(fig:CXCL12CeAsIPSCRS)b4).

Altogether, these results suggest that the CXCL12-triggered increase in the frequency of GABAergic transmission was mediated through the stimulation of CXCR4 and probably associated with the increase in spontaneous firing of interneurons, as this effect is eliminated by TTX.<!--, as indicated by increased sIPSC frequency in pyramidal neurons-->
However, astrocytes were also shown to be active players in GABAergic transmission onto Regular-Spiking neurons.

```{r CXCL12CeAsIPSCRS, fig.cap="**CXCL12 modulates GABAergic transmission onto Regular-Spiking neurons** Boxplots presenting population data of sIPSCs frequency**(a1)** and amplitude **(a2)** under different conditions. **(b1)** Representative current traces illustrating inhibitory synaptic currents (upward deflections) before (blue) and after (red) CXCL12(5nM) application in a Regular-Spiking neuron. **(b2)** Representative current traces illustrating inhibitory synaptic currents (upward deflections) before (blue) and after (red) CXCL12 application in the presence of TTX, blocking action-potentials. **(b3)** Representative current traces illustrating inhibitory synaptic currents (upward deflections) before (blue) and after (red) CXCL12 application in the presence of AMD3100, the CXCR4 blocker. **(b4)** Representative current traces illustrating inhibitory synaptic currents (upward deflections) before (blue) and after (red) CXCL12 application in the presence of fluorocitrate, an astrocytic toxin. Scale bar: 10pA, 1s", fig.align = 'center', echo = FALSE, message= FALSE, echo = FALSE, warning= FALSE, message = FALSE, fig.height= 6, fig.width= 15}
#knitr::include_graphics("images/results//CX3CL1_BLA_excitability.png")
#knitr::include_graphics("images/results//CX3CL1_BLA_excitability.png")

# loading needed subsets 

# making boxplots with facets

bp_CeA_freq_sIPSC_all <- plot_boxplot(CeA_sIPSC_all_subset, median_Frequency, ylabel = "IPSC Frequency (Hz)", vary1 = 0, vary2 = 4, dot_size = 2,  mtitle = "Late-Firing neurons") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5)) 

bp_CeA_freq_sIPSC_all <- bp_CeA_freq_sIPSC_all + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 14, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),  strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE, size = 8, label.y = 3) 


bp_CeA_freq_sIPSC_LF <- plot_boxplot(CeA_sIPSC_LF_subset, median_Frequency, ylabel = "IPSC Frequency (Hz)", vary1 = 0, vary2 = 4, dot_size = 2,  mtitle = "Late-Firing neurons") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5)) 

bp_CeA_freq_sIPSC_LF  <- bp_CeA_freq_sIPSC_LF  + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 14, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),  strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE, size = 8, label.y = 3) 

bp_CeA_freq_sIPSC_RS <- plot_boxplot(CeA_sIPSC_RS_subset, median_Frequency, ylabel = "IPSC Frequency (Hz)", vary1 = 0, vary2 = 4, dot_size = 2,  mtitle = "Regular-Spiking neurons") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5)) 

bp_CeA_freq_sIPSC_RS  <- bp_CeA_freq_sIPSC_RS  + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 14, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),  strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE, size = 8, label.y = 3) 

# making boxplots for amplitude
bp_CeA_amp_sIPSC_all  <- plot_boxplot(CeA_sIPSC_all_subset, median_Amplitude, ylabel = "IPSC Amplitude (pA)", vary1 = 0, vary2 = 30, dot_size = 2,  mtitle = "") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5))
bp_CeA_amp_sIPSC_all  <- bp_CeA_amp_sIPSC_all  + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 14, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),  strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE, size = 8, label.y = 35)


bp_CeA_amp_sIPSC_LF  <- plot_boxplot(CeA_sIPSC_LF_subset, median_Amplitude, ylabel = "IPSC Amplitude (pA)", vary1 = 0, vary2 = 30, dot_size = 2,  mtitle = "") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5))
bp_CeA_amp_sIPSC_LF  <- bp_CeA_amp_sIPSC_LF  + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 14, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),  strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE, size = 8, label.y = 35)

bp_CeA_amp_sIPSC_RS  <- plot_boxplot(CeA_sIPSC_RS_subset, median_Amplitude, ylabel = "IPSC Amplitude (pA)", vary1 = 0, vary2 = 30, dot_size = 2,  mtitle = "") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5))
bp_CeA_amp_sIPSC_RS  <- bp_CeA_amp_sIPSC_RS  + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 14, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),  strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE, size = 8, label.y = 35)

#importing representative traces
# fig("images//results//IV_representative_minoa.png", aspect.ratio = "free", b_pos = "inside", b_size = 0, b_margin =  ggplot2::margin(0, 0, 0, 0))
# representative_frak2nM <-  fig("images//results//CeA_frak2nM_sIPSC_frak2nM.png", aspect.ratio = "free", b_pos = "inside", b_size = 0, b_margin =  ggplot2::margin(0, 0, 0, 0))
# representative_azdfrak2nM <- fig("images//results//CeA_frak2nM_sIPSC_azdfrak.png", aspect.ratio = "free", b_pos = "inside", b_size = 0, b_margin =  ggplot2::margin(0, 0, 0, 0))
# representative_minofrak2nM <- fig("images//results//CeA_frak2nM_sIPSC_minofrak.png", aspect.ratio = "free", b_pos = "inside", b_size = 0, b_margin =  ggplot2::margin(0, 0, 0, 0))
# representative_ttxfrak2nM <- fig("images//results//CeA_frak2nM_mIPSC_frak2nM.png", aspect.ratio = "free", b_pos = "inside", b_size = 0, b_margin =  ggplot2::margin(0, 0, 0, 0))


#using patchwork to do layout of the figure
A <- (bp_CeA_freq_sIPSC_RS | bp_CeA_amp_sIPSC_RS) + plot_layout(tag_level = "new")
#B <- (bp_CeA_amp_sIPSC_all  | bp_CeA_amp_sIPSC_RS | bp_CeA_amp_sIPSC_LF ) + plot_layout(tag_level = "new", widths = c(0.2, 1, 1))
#C <-  ((representative_frak2nM + ggtitle("CX3CL1(2nM)")) | (representative_ttxfrak2nM + ggtitle("TTX + CX3CL1(2nM)")))
#D <-  ((representative_azdfrak2nM + ggtitle("AZD8797 + CX3CL1(2nM)")) | (representative_minofrak2nM + ggtitle("minocycline + CX3CL1(2nM)"))) 

# C <- (((traces_frak2nM +  ggtitle('CX3CL1(2nM)')) | (traces_azdfrak + ggtitle('AZD8797 + CX3CL1(2nM)')) | (traces_minofrak + ggtitle('minocycline + CX3CL1(2nM)')) + plot_layout(tag_level = "new")))

lay <- "
AA
"

figure1 <- wrap_plots(A = A, design = lay)

figure1 <- figure1 + plot_annotation(tag_levels = c('a', '1'))


figure1

```



In contrast, in Late-Firing neurons, CXCL12 significantly reduced the sIPSC amplitude from `r round(CeA_sIPSC_LF_subset %>% filter(Experiment == 'CXCL12(5nM)' & Condition == "baseline") %>% ungroup() %>% summarize(mean(median_Amplitude)), digits = 2)` `r knitr::asis_output("\U00B1")` `r round(CeA_sIPSC_LF_subset %>% filter(Experiment == 'CXCL12(5nM)' & Condition == "baseline") %>% ungroup() %>% dplyr::summarize(x = sd(median_Amplitude), count = n()) %>% dplyr::summarize(x/sqrt(count)), digits = 3)` to `r round(CeA_sIPSC_LF_subset  %>% filter(Experiment == 'CXCL12(5nM)' & Condition == "CXCL12") %>% ungroup() %>% summarize(mean(median_Amplitude)), digits = 2)` `r knitr::asis_output("\U00B1")` `r round(CeA_sIPSC_LF_subset %>% filter(Experiment == 'CXCL12(5nM)' & Condition == "CXCL12") %>% ungroup() %>% dplyr::summarize(x = sd(median_Amplitude), count = n()) %>% dplyr::summarize(x/sqrt(count)), digits = 3)` pA (`r CeA_sIPSC_LF_stats_amp_5nM`, ).<!-- nr of neurons, animals figure? -->
This chemokine also lowered the sIPSC frequency from `r round(CeA_sIPSC_LF_subset %>% filter(Experiment == 'CXCL12(5nM)' & Condition == "baseline") %>% ungroup() %>% summarize(mean(median_Frequency)), digits = 2)` `r knitr::asis_output("\U00B1")` `r round(CeA_sIPSC_LF_subset %>% filter(Experiment == 'CXCL12(5nM)' & Condition == "baseline") %>% ungroup() %>% dplyr::summarize(x = sd(median_Frequency), count = n()) %>% dplyr::summarize(x/sqrt(count)), digits = 3)` to `r round(CeA_sIPSC_LF_subset  %>% filter(Experiment == 'CXCL12(5nM)' & Condition == "CXCL12") %>% ungroup() %>% summarize(mean(median_Frequency)), digits = 2)` `r knitr::asis_output("\U00B1")` `r round(CeA_sIPSC_LF_subset %>% filter(Experiment == 'CXCL12(5nM)' & Condition == "CXCL12") %>% ungroup() %>% dplyr::summarize(x = sd(median_Frequency), count = n()) %>% dplyr::summarize(x/sqrt(count)), digits = 3)` Hz (n = `r CeA_sIPSC_LF_subset %>% filter(Experiment == 'CXCL12(5nM)') %>% ungroup() %>% dplyr::select(Cell) %>% n_distinct()`, N = `r CeA_sIPSC_LF_subset %>% filter(Experiment == 'CXCL12(5nM)') %>% group_by(Filename) %>% mutate(animals = str_sub(Filename, start = 1, end = 5)) %>% ungroup() %>% dplyr::select(animals) %>% n_distinct()`, `r CeA_sIPSC_LF_stats_freq_5nM`, Figs. \@ref(fig:CXCL12CeAsIPSCLF)a3 and b3).
These effects were eliminated in the presence of AMD3100, a CXCR4 blocker (baseline amplitude in AMD3100: `r round(CeA_sIPSC_LF_subset %>% filter(Experiment == 'AMD3100 + \nCXCL12(5nM)' & Condition == "baseline") %>% ungroup() %>% summarize(mean(median_Amplitude)), digits = 2)` `r knitr::asis_output("\U00B1")` `r round(CeA_sIPSC_LF_subset %>% filter(Experiment == 'AMD3100 + \nCXCL12(5nM)' & Condition == "baseline") %>% ungroup() %>% dplyr::summarize(x = sd(median_Amplitude), count = n()) %>% dplyr::summarize(x/sqrt(count)), digits = 3)` pA, amplitude after CXCL12(5nM) in AMD3100 `r round(CeA_sIPSC_LF_subset  %>% filter(Experiment == 'AMD3100 + \nCXCL12(5nM)' & Condition == "CXCL12") %>% ungroup() %>% summarize(mean(median_Amplitude)), digits = 2)` `r knitr::asis_output("\U00B1")` `r round(CeA_sIPSC_LF_subset %>% filter(Experiment == 'AMD3100 + \nCXCL12(5nM)' & Condition == "CXCL12") %>% ungroup() %>% dplyr::summarize(x = sd(median_Amplitude), count = n()) %>% dplyr::summarize(x/sqrt(count)), digits = 3)` pA, `r CeA_sIPSC_LF_stats_amp_amd5nM`, 
and baseline frequency in AMD3100 `r round(CeA_sIPSC_LF_subset %>% filter(Experiment == 'AMD3100 + \nCXCL12(5nM)' & Condition == "baseline") %>% ungroup() %>% summarize(mean(median_Frequency)), digits = 2)` `r knitr::asis_output("\U00B1")` `r round(CeA_sIPSC_LF_subset %>% filter(Experiment == 'AMD3100 + \nCXCL12(5nM)' & Condition == "baseline") %>% ungroup() %>% dplyr::summarize(x = sd(median_Frequency), count = n()) %>% dplyr::summarize(x/sqrt(count)), digits = 3)` Hz vs. frequency after CXCL12(5nM) in AMD3100 `r round(CeA_sIPSC_LF_subset  %>% filter(Experiment == 'AMD3100 + \nCXCL12(5nM)' & Condition == "CXCL12") %>% ungroup() %>% summarize(mean(median_Frequency)), digits = 2)` `r knitr::asis_output("\U00B1")` `r round(CeA_sIPSC_LF_subset %>% filter(Experiment == 'AMD3100 + \nCXCL12(5nM)' & Condition == "CXCL12") %>% ungroup() %>% dplyr::summarize(x = sd(median_Frequency), count = n()) %>% dplyr::summarize(x/sqrt(count)), digits = 3)` Hz, n = `r CeA_sIPSC_LF_subset %>% filter(Experiment == 'AMD3100 + \nCXCL12(5nM)') %>% ungroup() %>% dplyr::select(Cell) %>% n_distinct()`, N = `r CeA_sIPSC_LF_subset %>% filter(Experiment == 'AMD3100 + \nCXCL12(5nM)') %>% group_by(Filename) %>% mutate(animals = str_sub(Filename, start = 1, end = 5)) %>% ungroup() %>% dplyr::select(animals) %>% n_distinct()`, `r CeA_sIPSC_LF_stats_freq_amd5nM`).
Moreover, the CXCL12-induced reduction in the both frequency and amplitude of sIPSC were also blocked by the astrocytic toxin, flurocitrate (baseline in flurocitrate: `r round(CeA_sIPSC_LF_subset %>% filter(Experiment == 'fluorocitrate + \nCXCL12(5nM)' & Condition == "baseline") %>% ungroup() %>% summarize(mean(median_Amplitude)), digits = 2)` `r knitr::asis_output("\U00B1")` `r round(CeA_sIPSC_LF_subset %>% filter(Experiment == 'fluorocitrate + \nCXCL12(5nM)' & Condition == "baseline") %>% ungroup() %>% dplyr::summarize(x = sd(median_Amplitude), count = n()) %>% dplyr::summarize(x/sqrt(count)), digits = 3)` pA, CXCL12(5nM) in fluorocitrate: `r round(CeA_sIPSC_LF_subset %>% filter(Experiment == 'fluorocitrate + \nCXCL12(5nM)' & Condition == "CXCL12") %>% ungroup() %>% summarize(mean(median_Amplitude)), digits = 2)` `r knitr::asis_output("\U00B1")` `r round(CeA_sIPSC_LF_subset %>% filter(Experiment == 'fluorocitrate + \nCXCL12(5nM)' & Condition == "CXCL12") %>% ungroup() %>% dplyr::summarize(x = sd(median_Amplitude), count = n()) %>% dplyr::summarize(x/sqrt(count)), digits = 3)` pA, `r CeA_sIPSC_LF_stats_amp_fluoro5nM`, 
and baseline frequency in fluorocitrate `r round(CeA_sIPSC_LF_subset %>% filter(Experiment == 'fluorocitrate + \nCXCL12(5nM)' & Condition == "baseline") %>% ungroup() %>% summarize(mean(median_Amplitude)), digits = 2)` `r knitr::asis_output("\U00B1")` `r round(CeA_sIPSC_LF_subset %>% filter(Experiment == 'fluorocitrate + \nCXCL12(5nM)' & Condition == "baseline") %>% ungroup() %>% dplyr::summarize(x = sd(median_Frequency), count = n()) %>% dplyr::summarize(x/sqrt(count)), digits = 3)` Hz, CXCL12(5nM) in fluorocitrate: `r round(CeA_sIPSC_LF_subset  %>% filter(Experiment == 'fluorocitrate + \nCXCL12(5nM)' & Condition == "CXCL12") %>% ungroup() %>% summarize(mean(median_Frequency)), digits = 2)` `r knitr::asis_output("\U00B1")` `r round(CeA_sIPSC_LF_subset %>% filter(Experiment == 'fluorocitrate + \nCXCL12(5nM)' & Condition == "CXCL12") %>% ungroup() %>% dplyr::summarize(x = sd(median_Frequency), count = n()) %>% dplyr::summarize(x/sqrt(count)), digits = 3)` Hz, n = `r CeA_sIPSC_LF_subset %>% filter(Experiment == 'fluorocitrate + \nCXCL12(5nM)') %>% ungroup() %>% dplyr::select(Cell) %>% n_distinct()`, N = `r CeA_sIPSC_LF_subset %>% filter(Experiment == 'fluorocitrate + \nCXCL12(5nM)') %>% group_by(Filename) %>% mutate(animals = str_sub(Filename, start = 1, end = 5)) %>% ungroup() %>% dplyr::select(animals) %>% n_distinct()`, `r CeA_sIPSC_LF_stats_freq_fluoro5nM`).<!--ładniej-->
Finally, to determine if decreased sIPSC frequency and amplitude by CXCL12 in Late-Firing cells were due to a change in the spontaneous action potential firing in the slice, TTX was used to block neuronal firing, and the mIPSC parameters were measured before and after the CXCL12 application.
CXCL12 was ineffective to modulate both the frequency (`r CeA_sIPSC_LF_stats_freq_ttx5nM`) and amplitude (n = `r CeA_sIPSC_LF_subset %>% filter(Experiment == 'TTX + \nCXCL12(5nM)') %>% ungroup() %>% dplyr::select(Cell) %>% n_distinct()`, N = `r CeA_sIPSC_LF_subset %>% filter(Experiment == 'TTX + \nCXCL12(5nM)') %>% group_by(Filename) %>% mutate(animals = str_sub(Filename, start = 1, end = 5)) %>% ungroup() %>% dplyr::select(animals) %>% n_distinct()`, `r CeA_sIPSC_LF_stats_amp_ttx5nM`) of mIPSC. 

Of note, further analysis of the IPSC kinetic parameters showed that the median rise times and decay times of the sIPSCs and mIPSCs from both Regular-Spiking and Late-Firing neurons were unchanged after CXCL12 treatment (Figure \@ref(fig:CXCL12CeAsIPSCfigapp) in Appendix \@ref(CXCL12CeAsIPSCappend)).

Collectively, these findings illustrate that the regulation of GABAergic transmission by CXCL12 is not only cell-specific but also dependent on spontaneous neuronal activity, and mediated *via* direct activation of CXCR4 and astrocytes.<!-- These effects of SDF-1 were mediated *via* CXCR4 as they were abrogated by administration of a selective CXCR4 antagonist.-->

```{r CXCL12CeAsIPSCLF, fig.cap='**CXCL12 modulates GABAergic transmission onto Late-Firing neurons** Boxplots presenting population data of sIPSCs frequency**(a1)** and amplitude **(a2)** under different conditions. **(b1)** Representative current traces illustrating inhibitory synaptic currents (upward deflections) before (blue) and after (red) CXCL12(5nM) application in a Late-Firing neuron. **(b2)** Representative current traces illustrating inhibitory synaptic currents (upward deflections) before (blue) and after (red) CXCL12 application in the presence of TTX, blocking action-potentials. **(b3)** Representative current traces illustrating inhibitory synaptic currents (upward deflections) before (blue) and after (red) CXCL12 application in the presence of AMD3100, the CXCR4 blocker. **(b4)** Representative current traces illustrating inhibitory synaptic currents (upward deflections) before (blue) and after (red) CXCL12 application in the presence of fluorocitrate, an astrocytic toxin. Scale bar: 10pA, 1s', fig.align = 'center', echo = FALSE, message= FALSE, echo = FALSE, warning= FALSE, message = FALSE, fig.height= 6, fig.width= 15}
#knitr::include_graphics("images/results//CX3CL1_BLA_excitability.png")
#knitr::include_graphics("images/results//CX3CL1_BLA_excitability.png")

# loading needed subsets 

# making boxplots with facets

bp_CeA_freq_sIPSC_all <- plot_boxplot(CeA_sIPSC_all_subset, median_Frequency, ylabel = "IPSC Frequency (Hz)", vary1 = 0, vary2 = 5, dot_size = 2,  mtitle = "Late-Firing neurons") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5)) 

bp_CeA_freq_sIPSC_all <- bp_CeA_freq_sIPSC_all + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 14, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),  strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE, size = 8, label.y = 3) 


bp_CeA_freq_sIPSC_LF <- plot_boxplot(CeA_sIPSC_LF_subset, median_Frequency, ylabel = "IPSC Frequency (Hz)", vary1 = 0, vary2 = 5, dot_size = 2,  mtitle = "Late-Firing neurons") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5)) 

bp_CeA_freq_sIPSC_LF  <- bp_CeA_freq_sIPSC_LF  + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 14, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),  strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE, size = 8, label.y = 3) 

bp_CeA_freq_sIPSC_RS <- plot_boxplot(CeA_sIPSC_RS_subset, median_Frequency, ylabel = "IPSC Frequency (Hz)", vary1 = 0, vary2 = 5, dot_size = 2,  mtitle = "Regular-Spiking neurons") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5)) 

bp_CeA_freq_sIPSC_RS  <- bp_CeA_freq_sIPSC_RS  + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 14, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),  strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE, size = 8, label.y = 3) 

# making boxplots for amplitude
bp_CeA_amp_sIPSC_all  <- plot_boxplot(CeA_sIPSC_all_subset, median_Amplitude, ylabel = "IPSC Amplitude (pA)", vary1 = 0, vary2 = 40, dot_size = 2,  mtitle = "") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5))
bp_CeA_amp_sIPSC_all  <- bp_CeA_amp_sIPSC_all  + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 14, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),  strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE, size = 8, label.y = 35)


bp_CeA_amp_sIPSC_LF  <- plot_boxplot(CeA_sIPSC_LF_subset, median_Amplitude, ylabel = "IPSC Amplitude (pA)", vary1 = 0, vary2 = 40, dot_size = 2,  mtitle = "") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5))
bp_CeA_amp_sIPSC_LF  <- bp_CeA_amp_sIPSC_LF  + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 14, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),  strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE, size = 8, label.y = 35)

bp_CeA_amp_sIPSC_RS  <- plot_boxplot(CeA_sIPSC_RS_subset, median_Amplitude, ylabel = "IPSC Amplitude (pA)", vary1 = 0, vary2 = 40, dot_size = 2,  mtitle = "") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5))
bp_CeA_amp_sIPSC_RS  <- bp_CeA_amp_sIPSC_RS  + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 14, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),  strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE, size = 8, label.y = 35)

#importing representative traces
# fig("images//results//IV_representative_minoa.png", aspect.ratio = "free", b_pos = "inside", b_size = 0, b_margin =  ggplot2::margin(0, 0, 0, 0))
# representative_frak2nM <-  fig("images//results//CeA_frak2nM_sIPSC_frak2nM.png", aspect.ratio = "free", b_pos = "inside", b_size = 0, b_margin =  ggplot2::margin(0, 0, 0, 0))
# representative_azdfrak2nM <- fig("images//results//CeA_frak2nM_sIPSC_azdfrak.png", aspect.ratio = "free", b_pos = "inside", b_size = 0, b_margin =  ggplot2::margin(0, 0, 0, 0))
# representative_minofrak2nM <- fig("images//results//CeA_frak2nM_sIPSC_minofrak.png", aspect.ratio = "free", b_pos = "inside", b_size = 0, b_margin =  ggplot2::margin(0, 0, 0, 0))
# representative_ttxfrak2nM <- fig("images//results//CeA_frak2nM_mIPSC_frak2nM.png", aspect.ratio = "free", b_pos = "inside", b_size = 0, b_margin =  ggplot2::margin(0, 0, 0, 0))


#using patchwork to do layout of the figure
A <- (bp_CeA_freq_sIPSC_LF | bp_CeA_amp_sIPSC_LF ) + plot_layout(tag_level = "new")

#C <-  ((representative_frak2nM + ggtitle("CX3CL1(2nM)")) | (representative_ttxfrak2nM + ggtitle("TTX + CX3CL1(2nM)")))
#D <-  ((representative_azdfrak2nM + ggtitle("AZD8797 + CX3CL1(2nM)")) | (representative_minofrak2nM + ggtitle("minocycline + CX3CL1(2nM)"))) 

# C <- (((traces_frak2nM +  ggtitle('CX3CL1(2nM)')) | (traces_azdfrak + ggtitle('AZD8797 + CX3CL1(2nM)')) | (traces_minofrak + ggtitle('minocycline + CX3CL1(2nM)')) + plot_layout(tag_level = "new")))

lay <- "
AA
"

figure1 <- wrap_plots(A = A, design = lay)

figure1 <- figure1 + plot_annotation(tag_levels = c('a', '1'))


figure1

# figure1 <-  (bp_CeA_s_freq_sIPSC_LF | bp_CeA_s_freq_sIPSC_RS) / 
#             (bp_CeA_s_amp_sIPSC_LF | bp_CeA_s_amp_sIPSC_RS) /
#             (bp_CeA_s_rt_sIPSC_LF | bp_CeA_s_rt_sIPSC_RS) /
#             (bp_CeA_s_dt_sIPSC_LF | bp_CeA_s_dt_sIPSC_RS)
 #   / 
  # 
  # ((pie_frak2_s_amp_sIPSC  | pie_frak5_s_amp_sIPSC  | pie_azdfrak5nM_s_amp_sIPSC  | pie_azd_s_amp_sIPSC  | pie_minofrak5nM_s_amp_sIPSC  | pie_mino_s_amp_sIPSC) + plot_layout(guides = "collect") & theme(legend.position = "bottom")  + plot_layout(tag_level = 'new')) / 

```




\newpage