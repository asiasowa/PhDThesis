# Appendix {#appendix}

## Suplementary data {#suppdata}

### CX3CL1 does not affect passive membrane properties of principal cells in the BLA {#CX3CL1membraneappendix}

In Figures (\@ref(fig:CX3CL1BLAexcitabilityfigall1) and \@ref(fig:CX3CL1BLAexcitabilityfigall2)) and Table \@ref(tab:CX3CL1BLAexcitabilityappendixtable) <!--raczej bez numeracji bo mi samo knitr nie daje rady :((( ///(\@ref(tab:CX3CL1_BLA_excitability_appendix))--> below are depicted and listed all the passive membrane properties measured in the principal cells in the BLA following CX3CL1 treatment. 

```{r CX3CL1BLAexcitabilityappendixtable, tab.caption = "blabla", echo= FALSE, message= FALSE, warning = FALSE, error = FALSE, results='asis'}

# getting the table of statistics
CX3CL1_BLA_stat_df <- formattable(stat_table_exp_membr_extended((BLA_df_final)))

# kable not working with those complex table
# knitr::kable(CX3CL1_BLA_stat_df, booktabs = TRUE,
#  caption = 'The table of all of measured passive membrane parameters in the BLA following CX3CL1 application with all the conditions'
# ) 

library(gt)

table <- CX3CL1_BLA_stat_df %>% 
gt(groupname_col = "Variable") %>%
   fmt_markdown(columns = c("Experiment")) %>%
    tab_options(
      table.font.names = "Calibri",
      table.font.size = 12
  ) %>% #table.font.size = 11
#  tab_options(
 #   table.width = pct(100)) %>%
      tab_style(
    style = list(
      cell_text(weight = "bold")
      ),
    locations = cells_row_groups()
  ) %>%
    opt_row_striping() %>%
      tab_header(
    title = ("Table 7.1. Statistics of all measured parameters in relation to BLA principal cells membrane properties following CX3CL1 application"),
     subtitle = md("")) %>%
    opt_row_striping() %>%
   tab_source_note(source_note = md(""))  %>%
             gtsave("CX3CL1_membrane_table.html")

knitr::include_graphics("CX3CL1_membrane_table.html")
```

```{r CX3CL1BLAexcitabilityfigall1, fig.cap= 'CX3CL1 actions on membrane properties of BLA principal cells.', fig.align = 'center', echo= FALSE, message= FALSE, warning = FALSE, error = FALSE, results='asis', fig.height= 18, fig.width= 12}

# insets 
inset_frak2nM <- image_read("images//results//inset_frak2nM.png")
inset_frak2nM <- image_ggplot(inset_frak2nM)
inset_frak5nM <- image_read("images//results//inset_frak5nM.png")
inset_frak5nM <- image_ggplot(inset_frak5nM)
inset_ab <- image_read("images//results//inset_ab.png")
inset_ab <- image_ggplot(inset_ab)
inset_azdfrak2nM <- image_read("images//results//inset_azdfrak2nM.png")
inset_azdfrak2nM <- image_ggplot(inset_azdfrak2nM)
inset_azda <- image_read("images//results//inset_azd.png")
inset_azda <- image_ggplot(inset_azda)
inset_minofrak2nM <- image_read("images//results//inset_minofrak2nM.png")
inset_minofrak2nM <- image_ggplot(inset_minofrak2nM)
inset_minoa <- image_read("images//results//inset_minoa.png")
inset_minoa <- image_ggplot(inset_minoa)
inset_gaba <- image_read("images//results//inset_gaba.png")
inset_gaba <- image_ggplot(inset_gaba)


# GAIN
bp_BLA_gain <- plot_boxplot(BLA_df_final, gain, mtitle= "gain", ylabel = "gain",  dot_size = 2)
bp_BLA_gain <- bp_BLA_gain + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), 
  strip.text = element_text(size = 11, face="bold"), strip.background = element_blank())  + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)


pie_BLA_frak_gain <- BLA_df_final %>% filter(Experiment == 'CX3CL1(2nM)') %>% plot_pie_val15(gain, "CX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_frak5nM_gain <- BLA_df_final %>% filter(Experiment == 'CX3CL1(5nM)') %>% plot_pie_val15(gain, "CX3CL1(5nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_antifrak_gain <- BLA_df_final %>% filter(Experiment == 'anti-CX3CR1 + \nCX3CL1(2nM)') %>% plot_pie_val15(gain, 'anti-CX3CR1 + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_azdfrak_gain <- BLA_df_final %>% filter(Experiment == 'AZD8797 + \nCX3CL1(2nM)') %>% plot_pie_val15(gain, "AZD8797 + \nCX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_azd_gain <- BLA_df_final %>% filter(Experiment == "AZD8797") %>% plot_pie_val15(gain, "AZD8797") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_minofrak_gain <- BLA_df_final %>% filter(Experiment == 'minocycline + \nCX3CL1(2nM)') %>% plot_pie_val15(gain, 'minocycline + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_mino_gain <- BLA_df_final %>% filter(Experiment == 'minocycline') %>% plot_pie_val15(gain, "minocycline") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_picro_gain <- BLA_df_final %>% filter(Experiment == 'picrotoxin + \nCGP52432 + \nCX3CL1(2nM)') %>% plot_pie_val15(gain, 'picrotoxin + \nCGP52432 + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))


# ADAPTATION
bp_BLA_adap <- plot_boxplot(BLA_df_final, Adaptation_ratio, ylabel = "Adaptation ratio", mtitle = "Adaptation Ratio", vary1 = 0, vary2 = 1.5, dot_size = 2)
bp_BLA_adap <- bp_BLA_adap + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), 
  strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)


pie_BLA_frak_adap <- BLA_df_final %>% filter(Experiment == 'CX3CL1(2nM)') %>% plot_pie2(Adaptation_ratio, "CX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_frak5nM_adap <- BLA_df_final %>% filter(Experiment == 'CX3CL1(5nM)') %>% plot_pie2(Adaptation_ratio, "CX3CL1(5nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_antifrak_adap <- BLA_df_final %>% filter(Experiment == 'anti-CX3CR1 + \nCX3CL1(2nM)') %>% plot_pie2(Adaptation_ratio, 'anti-CX3CR1 + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_azdfrak_adap <- BLA_df_final %>% filter(Experiment == 'AZD8797 + \nCX3CL1(2nM)') %>% plot_pie2(Adaptation_ratio, "AZD8797 + \nCX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_azd_adap <- BLA_df_final %>% filter(Experiment == "AZD8797") %>% plot_pie2(Adaptation_ratio, "AZD8797") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_minofrak_adap <- BLA_df_final %>% filter(Experiment == 'minocycline + \nCX3CL1(2nM)') %>% plot_pie2(Adaptation_ratio, 'minocycline + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_mino_adap <- BLA_df_final %>% filter(Experiment == 'minocycline') %>% plot_pie2(Adaptation_ratio, "minocycline") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_picro_adap <- BLA_df_final %>% filter(Experiment == 'picrotoxin + \nCGP52432 + \nCX3CL1(2nM)') %>% plot_pie2(Adaptation_ratio, 'picrotoxin + \nCGP52432 + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))


# INPUT RESISTANCE
f_labels_BLA_rm <- data.frame(Experiment = c( c("CX3CL1(2nM)" , "CX3CL1(5nM)", 'anti-CX3CR1 + \nCX3CL1(2nM)' ,"AZD8797 + \nCX3CL1(2nM)", "AZD8797", 'minocycline + \nCX3CL1(2nM)' , "minocycline" , 'picrotoxin + \nCGP52432 + \nCX3CL1(2nM)' )), label = c("", "", "", "", "", "", "*", ""))
f_labels_BLA_rm$Experiment <- factor(f_labels_BLA_rm$Experiment, levels = c("CX3CL1(2nM)" , "CX3CL1(5nM)", 'anti-CX3CR1 + \nCX3CL1(2nM)' ,"AZD8797 + \nCX3CL1(2nM)", "AZD8797", 'minocycline + \nCX3CL1(2nM)' , "minocycline" , 'picrotoxin + \nCGP52432 + \nCX3CL1(2nM)'))
bp_BLA_rm <- plot_boxplot(BLA_df_final, Rm_20, ylabel = "Input resistance (MOhm)", mtitle = "Input resistance", vary1 = 0, vary2 = 250, dot_size = 2)
bp_BLA_rm <- bp_BLA_rm + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), 
  strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center') + geom_text(x = 1.5, y = 800, aes(label = label, color = NULL, group= NULL), data = f_labels_BLA_rm)

pie_BLA_frak_rm <- BLA_df_final %>% filter(Experiment == 'CX3CL1(2nM)') %>% plot_pie2(Rm_20, "CX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_frak5nM_rm <- BLA_df_final %>% filter(Experiment == 'CX3CL1(5nM)') %>% plot_pie2(Rm_20, "CX3CL1(5nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_antifrak_rm <- BLA_df_final %>% filter(Experiment == 'anti-CX3CR1 + \nCX3CL1(2nM)') %>% plot_pie2(Rm_20, 'anti-CX3CR1 + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_azdfrak_rm <- BLA_df_final %>% filter(Experiment == 'AZD8797 + \nCX3CL1(2nM)') %>% plot_pie2(Rm_20, "AZD8797 + \nCX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_azd_rm <- BLA_df_final %>% filter(Experiment == "AZD8797") %>% plot_pie2(Rm_20, "AZD8797") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_minofrak_rm <- BLA_df_final %>% filter(Experiment == 'minocycline + \nCX3CL1(2nM)') %>% plot_pie2(Rm_20, 'minocycline + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_mino_rm <- BLA_df_final %>% filter(Experiment == 'minocycline') %>% plot_pie2(Rm_20, "minocycline") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_picro_rm <- BLA_df_final %>% filter(Experiment == 'picrotoxin + \nCGP52432 + \nCX3CL1(2nM)') %>% plot_pie2(Rm_20, 'picrotoxin + \nCGP52432 + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))


# TAU
bp_BLA_tau <- plot_boxplot(BLA_df_final, tau_20, ylabel = "tau (ms)", mtitle = "tau", vary1 = 0, vary2 = 40, dot_size = 2)
bp_BLA_tau <- bp_BLA_tau + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), 
  strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)


pie_BLA_frak_tau <- BLA_df_final %>% filter(Experiment == 'CX3CL1(2nM)') %>% plot_pie2(tau_20, "CX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_frak5nM_tau <- BLA_df_final %>% filter(Experiment == 'CX3CL1(5nM)') %>% plot_pie2(tau_20, "CX3CL1(5nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_antifrak_tau <- BLA_df_final %>% filter(Experiment == 'anti-CX3CR1 + \nCX3CL1(2nM)') %>% plot_pie2(tau_20, 'anti-CX3CR1 + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_azdfrak_tau <- BLA_df_final %>% filter(Experiment == 'AZD8797 + \nCX3CL1(2nM)') %>% plot_pie2(tau_20, "AZD8797 + \nCX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_azd_tau <- BLA_df_final %>% filter(Experiment == "AZD8797") %>% plot_pie2(tau_20, "AZD8797") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_minofrak_tau <- BLA_df_final %>% filter(Experiment == 'minocycline + \nCX3CL1(2nM)') %>% plot_pie2(tau_20, 'minocycline + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_mino_tau <- BLA_df_final %>% filter(Experiment == 'minocycline') %>% plot_pie2(tau_20, "minocycline") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_picro_tau <- BLA_df_final %>% filter(Experiment == 'picrotoxin + \nCGP52432 + \nCX3CL1(2nM)') %>% plot_pie2(tau_20, 'picrotoxin + \nCGP52432 + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))

# CAPACITANCE
bp_BLA_cap <- plot_boxplot(BLA_df_final, C_20, ylabel = "Capacitance (pF)", mtitle = "Capacitance", vary1 = 90, vary2 = 500, dot_size = 2)
bp_BLA_cap <- bp_BLA_cap + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), 
  strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)

pie_BLA_frak_cap <- BLA_df_final %>% filter(Experiment == 'CX3CL1(2nM)') %>% plot_pie2(C_20, "CX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_frak5nM_cap <- BLA_df_final %>% filter(Experiment == 'CX3CL1(5nM)') %>% plot_pie2(C_20, "CX3CL1(5nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_antifrak_cap <- BLA_df_final %>% filter(Experiment == 'anti-CX3CR1 + \nCX3CL1(2nM)') %>% plot_pie2(C_20, 'anti-CX3CR1 + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_azdfrak_cap <- BLA_df_final %>% filter(Experiment == 'AZD8797 + \nCX3CL1(2nM)') %>% plot_pie2(C_20, "AZD8797 + \nCX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_azd_cap <- BLA_df_final %>% filter(Experiment == "AZD8797") %>% plot_pie2(C_20, "AZD8797") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_minofrak_cap <- BLA_df_final %>% filter(Experiment == 'minocycline + \nCX3CL1(2nM)') %>% plot_pie2(C_20, 'minocycline + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_mino_cap <- BLA_df_final %>% filter(Experiment == 'minocycline') %>% plot_pie2(C_20, "minocycline") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_picro_cap <- BLA_df_final %>% filter(Experiment == 'picrotoxin + \nCGP52432 + \nCX3CL1(2nM)') %>% plot_pie2(C_20, 'picrotoxin + \nCGP52432 + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))


# SAG
bp_BLA_sag <- plot_boxplot(BLA_df_sag, sag_ratio_140, ylabel = "sag ratio @-140 pA", mtitle = "sag ratio", dot_size = 2)
bp_BLA_sag <- bp_BLA_sag + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), 
  strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)

pie_BLA_frak_sag <- BLA_df_sag %>% filter(Experiment == 'CX3CL1(2nM)') %>% plot_pie_val3(sag_ratio_140, "CX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_frak5nM_sag <- BLA_df_sag %>% filter(Experiment == 'CX3CL1(5nM)') %>% plot_pie_val3(sag_ratio_140, "CX3CL1(5nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_antifrak_sag <- BLA_df_sag %>% filter(Experiment == 'anti-CX3CR1 + \nCX3CL1(2nM)') %>% plot_pie_val3(sag_ratio_140, 'anti-CX3CR1 + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_azdfrak_sag <- BLA_df_sag %>% filter(Experiment == 'AZD8797 + \nCX3CL1(2nM)') %>% plot_pie_val3(sag_ratio_140, "AZD8797 + \nCX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_azd_sag <- BLA_df_sag %>% filter(Experiment == "AZD8797") %>% plot_pie_val3(sag_ratio_140, "AZD8797") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_minofrak_sag <- BLA_df_sag %>% filter(Experiment == 'minocycline + \nCX3CL1(2nM)') %>% plot_pie_val3(sag_ratio_140, 'minocycline + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_mino_sag <- BLA_df_sag %>% filter(Experiment == 'minocycline') %>% plot_pie_val3(sag_ratio_140, "minocycline") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_picro_sag <- BLA_df_sag %>% filter(Experiment == 'picrotoxin + \nCGP52432 + \nCX3CL1(2nM)') %>% plot_pie_val3(sag_ratio_140, 'picrotoxin + \nCGP52432 + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))



# RESTING MEMBRANE POTENTIAL
bp_BLA_vm <- plot_boxplot(BLA_df_final, RMS, ylabel = "Resting membrane potential (mV)", mtitle = "Resting membrane potential", vary1 = -90, vary2 = -45, dot_size = 2)
bp_BLA_vm <- bp_BLA_vm + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), , 
  strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) #+ stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)

pie_BLA_frak_vm <- BLA_df_final %>% filter(Experiment == 'CX3CL1(2nM)') %>% plot_pie_val3(RMS, "CX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_frak5nM_vm <- BLA_df_final %>% filter(Experiment == 'CX3CL1(5nM)') %>% plot_pie_val3(RMS, "CX3CL1(5nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_antifrak_vm <- BLA_df_final %>% filter(Experiment == 'anti-CX3CR1 + \nCX3CL1(2nM)') %>% plot_pie_val3(RMS, 'anti-CX3CR1 + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_azdfrak_vm <- BLA_df_final %>% filter(Experiment == 'AZD8797 + \nCX3CL1(2nM)') %>% plot_pie_val3(RMS, "AZD8797 + \nCX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_azd_vm <- BLA_df_final %>% filter(Experiment == "AZD8797") %>% plot_pie_val3(RMS, "AZD8797") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_minofrak_vm <- BLA_df_final %>% filter(Experiment == 'minocycline + \nCX3CL1(2nM)') %>% plot_pie_val3(RMS, 'minocycline + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_mino_vm <- BLA_df_final %>% filter(Experiment == 'minocycline') %>% plot_pie_val3(RMS, "minocycline") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_picro_vm <- BLA_df_final %>% filter(Experiment == 'picrotoxin + \nCGP52432 + \nCX3CL1(2nM)') %>% plot_pie_val3(RMS, 'picrotoxin + \nCGP52432 + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))


# ACTION POTENTIAL WIDTH
bp_BLA_apw <- plot_boxplot(BLA_df_final, AP_width1_all, ylabel = "Action potential width (ms)", mtitle = "Action potential width", vary1 = 0.5, vary2 = 1.5, dot_size = 2)
bp_BLA_apw  <- bp_BLA_apw  + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), 
  strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) #+ stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)

pie_BLA_frak_apw  <- BLA_df_final %>% filter(Experiment == 'CX3CL1(2nM)') %>% plot_pie_val3(AP_width1_all, "CX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_frak5nM_apw  <- BLA_df_final %>% filter(Experiment == 'CX3CL1(5nM)') %>% plot_pie_val3(AP_width1_all, "CX3CL1(5nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_antifrak_apw  <- BLA_df_final %>% filter(Experiment == 'anti-CX3CR1 + \nCX3CL1(2nM)') %>% plot_pie_val3(AP_width1_all, 'anti-CX3CR1 + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_azdfrak_apw  <- BLA_df_final %>% filter(Experiment == 'AZD8797 + \nCX3CL1(2nM)') %>% plot_pie_val3(AP_width1_all, "AZD8797 + \nCX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_azd_apw  <- BLA_df_final %>% filter(Experiment == "AZD8797") %>% plot_pie_val3(AP_width1_all, "AZD8797") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_minofrak_apw  <- BLA_df_final %>% filter(Experiment == 'minocycline + \nCX3CL1(2nM)') %>% plot_pie_val3(AP_width1_all, 'minocycline + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_mino_apw  <- BLA_df_final %>% filter(Experiment == 'minocycline') %>% plot_pie_val3(AP_width1_all, "minocycline") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_picro_apw  <- BLA_df_final %>% filter(Experiment == 'picrotoxin + \nCGP52432 + \nCX3CL1(2nM)') %>% plot_pie_val3(AP_width1_all, 'picrotoxin + \nCGP52432 + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))


# ACTION POTENTIAL AMPLITUDE
bp_BLA_apa <- plot_boxplot(BLA_df_final, AP_amp1_all, ylabel = "Action potential amplitude (pA)", mtitle = "Action potential amplitude", vary1 = 50, vary2 = 120, dot_size = 2)
bp_BLA_apa <- bp_BLA_apa + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), 
  strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) #+ stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)

pie_BLA_frak_apa <- BLA_df_final %>% filter(Experiment == 'CX3CL1(2nM)') %>% plot_pie2(AP_amp1_all, "CX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_frak5nM_apa <- BLA_df_final %>% filter(Experiment == 'CX3CL1(5nM)') %>% plot_pie2(AP_amp1_all, "CX3CL1(5nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_antifrak_apa <- BLA_df_final %>% filter(Experiment == 'anti-CX3CR1 + \nCX3CL1(2nM)') %>% plot_pie2(AP_amp1_all, 'anti-CX3CR1 + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_azdfrak_apa <- BLA_df_final %>% filter(Experiment == 'AZD8797 + \nCX3CL1(2nM)') %>% plot_pie2(AP_amp1_all, "AZD8797 + \nCX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_azd_apa <- BLA_df_final %>% filter(Experiment == "AZD8797") %>% plot_pie2(AP_amp1_all, "AZD8797") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_minofrak_apa <- BLA_df_final %>% filter(Experiment == 'minocycline + \nCX3CL1(2nM)') %>% plot_pie2(AP_amp1_all, 'minocycline + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_mino_apa <- BLA_df_final %>% filter(Experiment == 'minocycline') %>% plot_pie2(AP_amp1_all, "minocycline") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_picro_apa <- BLA_df_final %>% filter(Experiment == 'picrotoxin + \nCGP52432 + \nCX3CL1(2nM)') %>% plot_pie2(AP_amp1_all, 'picrotoxin + \nCGP52432 + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))


# FAST AHP
bp_BLA_fast <- plot_boxplot(BLA_df_final, AHPf1_all, ylabel = "fast AHP (pA)", mtitle = "fast AHP", vary1 = -25, vary2 = 7, dot_size = 2)
bp_BLA_fast <- bp_BLA_fast + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), 
  strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) #+ stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)

pie_BLA_frak_fast <- BLA_df_final %>% filter(Experiment == 'CX3CL1(2nM)') %>% plot_pie2(AHPf1_all, "CX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_frak5nM_fast <- BLA_df_final %>% filter(Experiment == 'CX3CL1(5nM)') %>% plot_pie2(AHPf1_all, "CX3CL1(5nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_antifrak_fast <- BLA_df_final %>% filter(Experiment == 'anti-CX3CR1 + \nCX3CL1(2nM)') %>% plot_pie2(AHPf1_all, 'anti-CX3CR1 + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_azdfrak_fast <- BLA_df_final %>% filter(Experiment == 'AZD8797 + \nCX3CL1(2nM)') %>% plot_pie2(AHPf1_all, "AZD8797 + \nCX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_azd_fast <- BLA_df_final %>% filter(Experiment == "AZD8797") %>% plot_pie2(AHPf1_all, "AZD8797") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_minofrak_fast <- BLA_df_final %>% filter(Experiment == 'minocycline + \nCX3CL1(2nM)') %>% plot_pie2(AHPf1_all, 'minocycline + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_mino_fast <- BLA_df_final %>% filter(Experiment == 'minocycline') %>% plot_pie2(AHPf1_all, "minocycline") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_BLA_picro_fast <- BLA_df_final %>% filter(Experiment == 'picrotoxin + \nCGP52432 + \nCX3CL1(2nM)') %>% plot_pie2(AHPf1_all, 'picrotoxin + \nCGP52432 + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))

layout <- '
ABCDEZGH
IIIIIIII
JKLMNOPR'


figure1 <- (inset_frak2nM  | inset_frak5nM | inset_ab | inset_azdfrak2nM | inset_azda | inset_minofrak2nM | inset_minoa | inset_gaba) /
  bp_BLA_gain / 
  bp_BLA_adap /
  bp_BLA_rm / 
  bp_BLA_cap + plot_layout(heights = c(1, 0.8, 0.8, 0.8, 0.8))

figure2 <- bp_BLA_vm / bp_BLA_apw / bp_BLA_apa / bp_BLA_fast / bp_BLA_sag


 # bp_BLA_rm #/
 #  bp_BLA_cap /
 #  bp_BLA_vm /
 #  bp_BLA_apw /
 #  bp_BLA_apa /
 #  bp_BLA_fast /
 #  bp_BLA_sag 
#  + plot_layout(heights = c(1, 1.5, 1.5, 1.5, 1.5, 1.5, 1.5, 1.5, 1.5, 1.5, 1.5))
figure1

```

```{r CX3CL1BLAexcitabilityfigall2, fig.cap= 'CX3CL1 affects membrane properties of BLA principal cells.', fig.align = 'center', echo= FALSE, message= FALSE, warning = FALSE, error = FALSE, results='asis', fig.height= 18, fig.width= 12}
figure2
```

### CX3CL1 does not modulate excitatory synaptic transmission in the BLA {#CX3CL1sEPSCappendix}

Figure (\@ref(fig:CX3CL1BLAsEPSCfigall)) and Table 7.2<!--raczej bez numeracji bo mi samo knitr nie daje rady :((( ///(\@ref(tab:CX3CL1_BLA_excitability_appendix))--> reports on sEPSC parameters measured in principal cells in the BLA before and after CX3CL1, AZD8797, and minocycline treatment. 

```{r CX3CL1BLAsEPSCappendixtable, echo= FALSE, message= FALSE, warning = FALSE, error = FALSE, results='asis'}

# slicing one mEPSC condition from the table and adding it to the main table
mEPSC_sliced <- BLA_mEPSC_final %>% dplyr::filter(Experiment == 'CX3CL1(2nM)')
mEPSC_sliced$Experiment <- plyr::revalue(mEPSC_sliced$Experiment, c("CX3CL1(2nM)"="TTX + \nCX3CL1(2nM)"))
BLA_sEPSC_final <- BLA_sEPSC_final %>% bind_rows(mEPSC_sliced)
levels(BLA_sEPSC_final$Experiment)
#futher selecting conditions to show
BLA_sEPSC_final <- BLA_sEPSC_final %>% dplyr::filter(Experiment %in% c('CX3CL1(2nM)', 'CX3CL1(5nM)', 'TTX + \nCX3CL1(2nM)', 'AZD8797', 'minocycline'))
BLA_sEPSC_final$Experiment <- factor(BLA_sEPSC_final$Experiment, levels = c('CX3CL1(2nM)', 'CX3CL1(5nM)', 'TTX + \nCX3CL1(2nM)', 'AZD8797', 'minocycline'))

BLA_sEPSC_final$Cell <- rep(1:(nrow(BLA_sEPSC_final)/2), each = 2)
BLA_sEPSC_final$Condition <- factor(BLA_sEPSC_final$Condition, levels = c("baseline", "CX3CL1", "AZD8797", "minocycline"))
# getting the table of statistics
CX3CL1_BLA_sEPSC_stat_df <- formattable(stat_table_exp_syn_extended((BLA_sEPSC_final)))

# kable not working with those complex table
# knitr::kable(CX3CL1_BLA_stat_df, booktabs = TRUE,
#  caption = 'The table of all of measured passive membrane parameters in the BLA following CX3CL1 application with all the conditions'
# ) 

table_BLA_sEPSC <- CX3CL1_BLA_sEPSC_stat_df %>% 
gt(groupname_col = "Variable") %>%
   fmt_markdown(columns = c("Experiment")) %>%
    tab_options(
      table.font.names = "Calibri",
      table.font.size = 12
  ) %>% #table.font.size = 11
#  tab_options(
 #   table.width = pct(100)) %>%
      tab_style(
    style = list(
      cell_text(weight = "bold")
      ),
    locations = cells_row_groups()
  ) %>%
    opt_row_striping() %>%
      tab_header(
    title = ("Table 7.2. Statistics of all measured parameters regarding CX3CL1 effects on excitatory synaptic transmission onto BLA principal cells"),
     subtitle = md("")) %>%
    opt_row_striping() %>%
   tab_source_note(source_note = md("")) %>%
   gtsave("CX3CL1_sEPSC_table.html")

knitr::include_graphics("CX3CL1_sEPSC_table.html")
```

```{r CX3CL1BLAsEPSCfigall, fig.cap= 'CX3CL1 actions on membrane properties of BLA principal cells.', fig.align = 'center', echo= FALSE, message= FALSE, warning = FALSE, error = FALSE, results='asis', fig.height= 18, fig.width= 12}

# insets 
inset_frak2nM <- image_read("images//results//inset_frak2nM.png")
inset_frak2nM <- image_ggplot(inset_frak2nM)
inset_frak5nM <- image_read("images//results//inset_frak5nM.png")
inset_frak5nM <- image_ggplot(inset_frak5nM)
inset_ab <- image_read("images//results//inset_ab.png")
inset_ab <- image_ggplot(inset_ab)
inset_azdfrak2nM <- image_read("images//results//inset_azdfrak2nM.png")
inset_azdfrak2nM <- image_ggplot(inset_azdfrak2nM)
inset_azda <- image_read("images//results//inset_azd.png")
inset_azda <- image_ggplot(inset_azda)
inset_minofrak2nM <- image_read("images//results//inset_minofrak2nM.png")
inset_minofrak2nM <- image_ggplot(inset_minofrak2nM)
inset_minoa <- image_read("images//results//inset_minoa.png")
inset_minoa <- image_ggplot(inset_minoa)
inset_gaba <- image_read("images//results//inset_gaba.png")
inset_gaba <- image_ggplot(inset_gaba)
inset_ttx <- image_read("images//results//inset_ttx.png")
inset_ttx <- image_ggplot(inset_ttx)

# creating boxplot 
bp_BLA_s_freq <- plot_boxplot(BLA_sEPSC_final, median_Frequency, ylabel = "sEPSC Frequency (Hz)", vary1 = 0, vary2 = 20, dot_size = 2,  mtitle = "sEPSC Frequency") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), strip.text = element_text(size = 11, face="bold"), strip.background = element_blank())
bp_BLA_s_freq <- bp_BLA_s_freq + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 14, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5)) #+  annotate("text", x = 'CX3CL1(2nM)', y = 110, label = "p = 0.047")
# creating piecharts

pie_frak2_s_freq <- BLA_frak2nM_sEPSC %>% plot_pie(median_Frequency, "CX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_frak5_s_freq <- BLA_frak5nM_sEPSC %>% plot_pie(median_Frequency, "CX3CL1(5nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_azdfrak_s_freq <- BLA_azd_sEPSC %>% plot_pie(median_Frequency, "AZD8797 + \nCX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_azd_s_freq <- BLA_azda_sEPSC %>% plot_pie(median_Frequency, "AZD8797") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_anti_s_freq <- BLA_anti_sEPSC %>% plot_pie(median_Frequency, "anti-CX3CR1 + \nCX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_minofrak_s_freq <- BLA_mino_sEPSC %>% plot_pie(median_Frequency, "minocycline + \nCX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_mino_s_freq <- BLA_minoa_sEPSC %>% plot_pie(median_Frequency, "minocycline") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_picro_s_freq <- BLA_picro_sEPSC %>% plot_pie(median_Frequency, 'picrotoxin + \nCGP52432 + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_frak2_m_freq <- BLA_frak2nM_mEPSC %>% plot_pie(median_Frequency, "CX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))


# amplitude
bp_BLA_s_amp <- plot_boxplot(BLA_sEPSC_final, median_Amplitude, ylabel = "sEPSC Amplitude (pA)", vary1 = 0, vary2 = 20, dot_size = 2,  mtitle = "sEPSC Amplitude") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), strip.text = element_text(size = 11, face="bold"), strip.background = element_blank())
bp_BLA_s_amp <- bp_BLA_s_amp + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 14, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5)) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)

pie_frak2_s_amp <- BLA_frak2nM_sEPSC %>% plot_pie(median_Amplitude, "CX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_frak5_s_amp <- BLA_frak5nM_sEPSC %>% plot_pie(median_Amplitude, "CX3CL1(5nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_azdfrak_s_amp <- BLA_azd_sEPSC %>% plot_pie(median_Amplitude, "AZD8797 + \nCX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_azd_s_amp <- BLA_azda_sEPSC %>% plot_pie(median_Amplitude, "AZD8797") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_anti_s_amp <- BLA_anti_sEPSC %>% plot_pie(median_Amplitude, "anti-CX3CR1 + \nCX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_minofrak_s_amp <- BLA_mino_sEPSC %>% plot_pie(median_Amplitude, "minocycline + \nCX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_mino_s_amp <- BLA_minoa_sEPSC %>% plot_pie(median_Amplitude, "minocycline") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_picro_s_amp <- BLA_picro_sEPSC %>% plot_pie(median_Amplitude, 'picrotoxin + \nCGP52432 + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_frak2_m_amp <- BLA_frak2nM_mEPSC %>% plot_pie(median_Amplitude, "CX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
#b2 <- BLA_frak5nM_mEPSC %>% plot_pie(median_Amplitude)
#c2 <- BLA_azd_mEPSC %>% plot_pie(median_Amplitude)

# rise time
bp_BLA_s_rt <- plot_boxplot(BLA_sEPSC_final, median_RiseTime, ylabel = "sEPSC Rise Time (ms)", vary1 = 0, vary2 = 1, dot_size = 2,  mtitle = "sEPSC Rise Time") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), strip.text = element_text(size = 11, face="bold"), strip.background = element_blank())
bp_BLA_s_rt <- bp_BLA_s_rt + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 14, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5)) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)

pie_frak2_s_rt <- BLA_frak2nM_sEPSC %>% plot_pie(median_RiseTime, "CX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_frak5_s_rt <- BLA_frak5nM_sEPSC %>% plot_pie(median_RiseTime, "CX3CL1(5nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_azdfrak_s_rt <- BLA_azd_sEPSC %>% plot_pie(median_RiseTime, "AZD8797 + \nCX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_azd_s_rt <- BLA_azda_sEPSC %>% plot_pie(median_RiseTime, "AZD8797") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_anti_s_rt <- BLA_anti_sEPSC %>% plot_pie(median_RiseTime, "anti-CX3CR1 + \nCX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_minofrak_s_rt <- BLA_mino_sEPSC %>% plot_pie(median_RiseTime, "minocycline + \nCX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_mino_s_rt <- BLA_minoa_sEPSC %>% plot_pie(median_RiseTime, "minocycline") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_picro_s_rt <- BLA_picro_sEPSC %>% plot_pie(median_RiseTime, 'picrotoxin + \nCGP52432 + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))

pie_frak2_m_rt <- BLA_frak2nM_mEPSC %>% plot_pie(median_RiseTime, "CX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))

# decay time

bp_BLA_s_dt <- plot_boxplot(BLA_sEPSC_final, median_DecayTau, ylabel = "sEPSC Decay Time (Hz)", vary1 = 0, vary2 = 10, dot_size = 2,  mtitle = "sEPSC Decay Time") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), strip.text = element_text(size = 11, face="bold"), strip.background = element_blank())
bp_BLA_s_dt <- bp_BLA_s_dt + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 14, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5)) #+  annotate("text", x = 'CX3CL1(2nM)', y = 110, label = "p = 0.047")

bpn_BLA_s_dt <- plot_norm(BLA_sEPSC_final, median_DecayTau, ylabel = "normalized \n sEPSC Decay Time (%)", mtitle = "sEPSC Decay Time") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5))
bpn_BLA_m_dt <- plot_norm(BLA_mEPSC_final, median_DecayTau, ylabel = "normalized \n mEPSC Decay Time (%)", mtitle = "mEPSC Decay Time") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5))

pie_frak2_s_dt <- BLA_frak2nM_sEPSC %>% plot_pie(median_DecayTau, "CX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_frak5_s_dt <- BLA_frak5nM_sEPSC %>% plot_pie(median_DecayTau, "CX3CL1(5nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_azdfrak_s_dt <- BLA_azd_sEPSC %>% plot_pie(median_DecayTau, "AZD8797 + \nCX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_azd_s_dt <- BLA_azda_sEPSC %>% plot_pie(median_DecayTau, "AZD8797") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_anti_s_dt <- BLA_anti_sEPSC %>% plot_pie(median_DecayTau, "anti-CX3CR1 + \nCX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_minofrak_s_dt <- BLA_mino_sEPSC %>% plot_pie(median_DecayTau, "minocycline + \nCX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_mino_s_dt <- BLA_minoa_sEPSC %>% plot_pie(median_DecayTau, "minocycline") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_picro_s_dt <- BLA_picro_sEPSC %>% plot_pie(median_DecayTau, 'picrotoxin + \nCGP52432 + \nCX3CL1(2nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_frak2_m_dt <- BLA_frak2nM_mEPSC %>% plot_pie(median_DecayTau, "CX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))

figure1 <- ((inset_frak2nM  | inset_frak5nM | inset_ab | inset_ttx | inset_azda | inset_minoa) + plot_layout(tag_level = 'new'))/ bp_BLA_s_freq / 
bp_BLA_s_amp/ 
bp_BLA_s_rt /
bp_BLA_s_dt #+ plot_layout(heights = c(1, 0.8, 0.8, 0.8, 0.8))

figure1 <- figure1 + plot_annotation(tag_levels = c('a', '1'))

figure1




```

### CX3CL1 does not affect kinetics in inhibitory synaptic transmission in the BLA {#CX3CL1sIPSCappendix}

Effects of CX3CL1 on inhibitory synaptic transmission in summarized in Table <!--?-->.
In addition, Fig. \@ref(fig:CX3CL1BLAsIPSCappendixfig) presents the data regarding the lack of effects of CX3CL1 on sIPSCs/mIPSCs kinetics. 

```{r CX3CL1BLAsIPSCappendixtable, echo= FALSE, message= FALSE, warning = FALSE, error = FALSE, results='asis'}

# slicing one mEPSC condition from the table and adding it to the main table

# getting the table of statistics
CX3CL1_BLA_sIPSC_stat_df <- formattable(stat_table_exp_syn_extended((BLA_sIPSC_final)))

# kable not working with those complex table
# knitr::kable(CX3CL1_BLA_stat_df, booktabs = TRUE,
#  caption = 'The table of all of measured passive membrane parameters in the BLA following CX3CL1 application with all the conditions'
# ) 

table_BLA_sIPSC <- CX3CL1_BLA_sIPSC_stat_df %>% 
gt(groupname_col = "Variable") %>%
   fmt_markdown(columns = c("Experiment")) %>%
    tab_options(
      table.font.names = "Calibri",
      table.font.size = 12
  ) %>% #table.font.size = 11
#  tab_options(
 #   table.width = pct(100)) %>%
      tab_style(
    style = list(
      cell_text(weight = "bold")
      ),
    locations = cells_row_groups()
  ) %>%
    opt_row_striping() %>%
      tab_header(
    title = ("Table 7.3. Statistics of all measured parameters regarding CX3CL1 effects on excitatory synaptic transmission onto BLA principal cells"),
     subtitle = md("")) %>%
    opt_row_striping() %>%
   tab_source_note(source_note = md("")) %>%
   gtsave("CX3CL1_sIPSC_table.html")

knitr::include_graphics("CX3CL1_sIPSC_table.html")
```

```{r CX3CL1BLAsIPSCappendixfig, fig.cap='**CX3CL1 does not affect sIPSC/mIPSC kinetics in principal cells in the BLA** **a** Schematics illustrating recording conditions **b,c** Boxplots representing population data of sIPSCs rise time and decay time before and after CX3CL1 application in each condition, respectively.', fig.align = 'center', echo = FALSE, message= FALSE, echo = FALSE, warning= FALSE, message = FALSE, fig.height= 8, fig.width= 12}
#knitr::include_graphics("images/results//CX3CL1_BLA_excitability.png")
#knitr::include_graphics("images/results//CX3CL1_BLA_excitability.png")

# loading needed subsets 
inset_frak2nM <- image_read("images//results//inset_frak2nM.png")
inset_frak2nM <- image_ggplot(inset_frak2nM)
inset_frak5nM <- image_read("images//results//inset_frak5nM.png")
inset_frak5nM <- image_ggplot(inset_frak5nM)
inset_azdfrak5nM <- image_read("images//results//inset_azdfrak5nM.png") # AZD5nM zrobić
inset_azdfrak5nM <- image_ggplot(inset_azdfrak5nM)
inset_azda <- image_read("images//results//inset_azd.png")
inset_azda <- image_ggplot(inset_azda)
inset_minofrak5nM <- image_read("images//results//inset_minofrak5nM.png") # minocycline 5Nm ZROBIĆ
inset_minofrak5nM <- image_ggplot(inset_minofrak5nM)
inset_minoa <- image_read("images//results//inset_minoa.png")
inset_minoa <- image_ggplot(inset_minoa)
inset_ttx <- image_read("images//results//inset_ttx.png")
inset_ttx <- image_ggplot(inset_ttx)
inset_ttx_5nM <- image_read("images//results//inset_ttx_5nM.png")
inset_ttx_5nM <- image_ggplot(inset_ttx_5nM)

# subsetting needed conditions from dataframe
#zrobione wyżej

# making boxplots with facets
bp_BLA_s_freq_sIPSC <- plot_boxplot(BLA_sIPSC_final, median_Frequency, ylabel = "sIPSC Frequency (Hz)", vary1 = 0, vary2 = 15, dot_size = 2,  mtitle = "") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5)) 

bp_BLA_s_freq_sIPSC  <- bp_BLA_s_freq_sIPSC  + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 14, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),  strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE, size = 8, label.y = 10) 

# making pie charts for conditions 
pie_frak2_s_freq_sIPSC  <- BLA_frak2nM_sIPSC %>% plot_pie(median_Frequency, "CX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_frak5_s_freq_sIPSC  <- BLA_frak5nM_sIPSC %>% plot_pie(median_Frequency, "CX3CL1(5nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_azdfrak5nM_s_freq_sIPSC  <- BLA_azdfrak5nM_sIPSC %>% plot_pie(median_Frequency, "AZD8797 + \nCX3CL1(5nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_azd_s_freq_sIPSC  <- BLA_azda_sIPSC %>% plot_pie(median_Frequency, "AZD8797") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_minofrak5nM_s_freq_sIPSC  <- BLA_minofrak5nM_sIPSC %>% plot_pie(median_Frequency, 'minocycline + \nCX3CL1(5nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_mino_s_freq_sIPSC  <- BLA_minoa_sIPSC %>% plot_pie(median_Frequency, "minocycline") + theme(plot.title = element_text(size= 10, hjust = 0.5))

pie_frak2_m_freq_sIPSC  <- BLA_frak2nM_sIPSC %>% plot_pie(median_Frequency, "TTX + \nCX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_frak5_m_freq_sIPSC  <- BLA_frak5nM_sIPSC %>% plot_pie(median_Frequency, "TTX + \nCX3CL1(5nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))

# making boxplots for amplitude
bp_BLA_s_amp_sIPSC  <- plot_boxplot(BLA_sIPSC_final, median_Amplitude, ylabel = "sIPSC Amplitude (pA)", vary1 = 0, vary2 = 40, dot_size = 2,  mtitle = "sIPSC Amplitude") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5))
bp_BLA_s_amp_sIPSC  <- bp_BLA_s_amp_sIPSC  + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 14, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),  strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE, size = 8, label.y = 35)

pie_frak2_s_amp_sIPSC <- BLA_frak2nM_sIPSC %>% plot_pie(median_Amplitude, "CX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_frak5_s_amp_sIPSC  <- BLA_frak5nM_sIPSC %>% plot_pie(median_Amplitude, "CX3CL1(5nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_azdfrak5nM_s_amp_sIPSC  <- BLA_azdfrak5nM_sIPSC %>% plot_pie(median_Amplitude, "AZD8797 + \nCX3CL1(5nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_azd_s_amp_sIPSC  <- BLA_azda_sIPSC %>% plot_pie(median_Amplitude, "AZD8797") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_minofrak5nM_s_amp_sIPSC  <- BLA_minofrak5nM_sIPSC %>% plot_pie(median_Amplitude, 'minocycline + \nCX3CL1(5nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_mino_s_amp_sIPSC  <- BLA_minoa_sIPSC %>% plot_pie(median_Amplitude, "minocycline") + theme(plot.title = element_text(size= 10, hjust = 0.5))

pie_frak2_m_amp_sIPSC  <- BLA_frak2nM_sIPSC %>% plot_pie(median_Amplitude, "TTX + \nCX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_frak5_m_amp_sIPSC  <- BLA_frak5nM_sIPSC %>% plot_pie(median_Amplitude, "TTX + \nCX3CL1(5nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))

# rise time
bp_BLA_s_rt_sIPSC  <- plot_boxplot(BLA_sIPSC_final, median_RiseTime, ylabel = "sIPSC Rise Time (ms)", vary1 = 0, vary2 = 3, dot_size = 2,  mtitle = "sIPSC Rise Time") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5))
bp_BLA_s_rt_sIPSC  <- bp_BLA_s_rt_sIPSC + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 14, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),  strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) #+  annotate("text", x = 'CX3CL1(2nM)', y = 110, label = "p = 0.047")
bp_BLA_m_rt_sIPSC  <- plot_boxplot(BLA_mIPSC_final, median_RiseTime, ylabel = "mIPSC Rise Time (ms)", vary1 = 0, vary2 = 3, dot_size = 2, mtitle = "mIPSC Rise Time") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5))
bp_BLA_m_rt_sIPSC  <- bp_BLA_m_rt_sIPSC + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 14, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),  strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) #+  annotate("text", x = 'CX3CL1(2nM)', y = 110, label = "p = 0.047")

# pie_frak2_s_rt_sIPSC  <- BLA_frak2nM_sIPSC %>% plot_pie(median_RiseTime, "CX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
# pie_frak5_s_rt_sIPSC  <- BLA_frak5nM_sIPSC %>% plot_pie(median_RiseTime, "CX3CL1(5nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
# pie_azdfrak5nM_s_rt_sIPSC  <- BLA_azdfrak5nM_sIPSC %>% plot_pie(median_RiseTime, "AZD8797 + \nCX3CL1(5nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
# pie_azd_s_rt_sIPSC  <- BLA_azda_sIPSC %>% plot_pie(median_RiseTime, "AZD8797") + theme(plot.title = element_text(size= 10, hjust = 0.5))
# pie_minofrak5nM_s_rt_sIPSC  <- BLA_minofrak5nM_sIPSC %>% plot_pie(median_RiseTime, 'minocycline + \nCX3CL1(5nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))
# pie_mino_s_rt_sIPSC  <- BLA_minoa_sIPSC %>% plot_pie(median_RiseTime, "minocycline") + theme(plot.title = element_text(size= 10, hjust = 0.5))
# 
# pie_frak2_m_rt_sIPSC  <- BLA_frak2nM_mIPSC %>% plot_pie(median_RiseTime, "CX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
# pie_frak5_m_rt_sIPSC  <- BLA_frak5nM_mIPSC %>% plot_pie(median_RiseTime, "CX3CL1(5nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))

# decay time

bp_BLA_s_dt_sIPSC  <- plot_boxplot(BLA_sIPSC_final, median_DecayTau, ylabel = "sIPSC Decay Time (Hz)", vary1 = 0, vary2 = 40, dot_size = 2,  mtitle = "sIPSC Decay Time") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5))
bp_BLA_s_dt_sIPSC  <- bp_BLA_s_dt_sIPSC  + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 14, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),  strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) #+  annotate("text", x = 'CX3CL1(2nM)', y = 110, label = "p = 0.047")
bp_BLA_m_dt_sIPSC  <- plot_boxplot(BLA_mIPSC_final, median_DecayTau, ylabel = "mIPSC Decay Time (Hz)", vary1 = 0, vary2 = 40, dot_size = 2, mtitle = "mIPSC Decay Time") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5))
bp_BLA_m_dt_sIPSC  <- bp_BLA_m_dt_sIPSC  + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 14, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),  strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) #+  annotate("text", x = 'CX3CL1(2nM)', y = 110, label = "p = 0.047")

pie_frak2_s_dt_sIPSC  <- BLA_frak2nM_sIPSC %>% plot_pie(median_DecayTau, "CX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_frak5_s_dt_sIPSC  <- BLA_frak5nM_sIPSC %>% plot_pie(median_DecayTau, "CX3CL1(5nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_azdfrak5nM_s_dt_sIPSC  <- BLA_azdfrak5nM_sIPSC %>% plot_pie(median_DecayTau, "AZD8797 + \nCX3CL1(5nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_azd_s_dt_sIPSC  <- BLA_azda_sIPSC %>% plot_pie(median_DecayTau, "AZD8797") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_minofrak5nM_s_dt_sIPSC  <- BLA_minofrak5nM_sIPSC %>% plot_pie(median_DecayTau, 'minocycline + \nCX3CL1(5nM)') + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_mino_s_dt_sIPSC  <- BLA_minoa_sIPSC %>% plot_pie(median_DecayTau, "minocycline") + theme(plot.title = element_text(size= 10, hjust = 0.5))

pie_frak2_m_dt_sIPSC  <- BLA_frak2nM_mIPSC %>% plot_pie(median_DecayTau, "CX3CL1(2nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))
pie_frak5_m_dt_sIPSC  <- BLA_frak5nM_mIPSC %>% plot_pie(median_DecayTau, "CX3CL1(5nM)") + theme(plot.title = element_text(size= 10, hjust = 0.5))

#using patchwork to do layout of the figure


figure1 <-  ((inset_frak2nM | inset_frak5nM | inset_azdfrak5nM | inset_azda | inset_minofrak5nM | inset_minoa | inset_ttx | inset_ttx_5nM)  + plot_layout(tag_level = 'new')) /
  (bp_BLA_s_rt_sIPSC + theme(legend.position = "none")) /
  (bp_BLA_s_dt_sIPSC + theme(legend.position = "none"))
 #   / 
  # 
  # ((pie_frak2_s_amp_sIPSC  | pie_frak5_s_amp_sIPSC  | pie_azdfrak5nM_s_amp_sIPSC  | pie_azd_s_amp_sIPSC  | pie_minofrak5nM_s_amp_sIPSC  | pie_mino_s_amp_sIPSC) + plot_layout(guides = "collect") & theme(legend.position = "bottom")  + plot_layout(tag_level = 'new')) / 


figure1 <- figure1 + 
  plot_annotation(tag_levels = c('a', '1')) #+ plot_layout(heights = c(1, 2, 1, 1))

figure1

```

### The differences between Regular-Spiking and Late-Firing neurons in reaction to CX3CL1, AZD8797, and minocycline 

```{r CX3CL1CeAintrinsicAZD, fig.cap='**Effects of AZD on threshold current in Regular Spiking Neurons in CeL.** **(a)** Schematics of presented conditions **(b)** Boxplots presenting threshold currents of each cell before and after CX3CL1 application **(c)** plots presenting input-output relationships of representative cell **e** representative voltage traces from representative cells to 300, 360 and 400pA injection currents prior to (blue) and after the AZD application (red). Scale bar: 10mV, 100ms ', fig.align = 'center', echo = FALSE, message= FALSE, echo = FALSE, warning= FALSE, message = FALSE, fig.width= 10, fig.height= 12}

#knitr::include_graphics("images/results//CX3CL1_BLA_excitability.png")
#knitr::include_graphics("images/results//CX3CL1_BLA_excitability.png")


inset_azda <- image_read("images//results//inset_azd.png")
inset_azda <- image_ggplot(inset_azda)

# making labels (as minocycline and azd has different condition than CX3CL1) for then making proper automatic statistics
# f_labels_BLA_thres <- data.frame(Experiment = c( c("CX3CL1(2nM)" , "CX3CL1(5nM)", 'anti-CX3CR1 + \nCX3CL1(2nM)', "AZD8797 + \nCX3CL1(2nM)", "AZD8797", 'minocycline + \nCX3CL1(2nM)' , "minocycline" , 'picrotoxin + \nCGP52432 + \nCX3CL1(2nM)' )), label = c("", "", "", "", "", "", "*", ""))
# f_labels_BLA_thres$Experiment <- factor(f_labels_BLA_thres$Experiment, levels = c("CX3CL1(2nM)" , "CX3CL1(5nM)", 'anti-CX3CR1 + \nCX3CL1(2nM)', "AZD8797 + \nCX3CL1(2nM)", "AZD8797", 'minocycline + \nCX3CL1(2nM)' , "minocycline" , 'picrotoxin + \nCGP52432 + \nCX3CL1(2nM)'))

## subsetting only CX3CL1 conditions
CeA_df_add_sub <- CeA_df_final %>% dplyr::filter(Experiment %in% c("AZD8797", "minocycline"))
CeA_df_add_sub_RS <- CeA_df_final_RS %>% dplyr::filter(Experiment %in% c("AZD8797", "minocycline"))
CeA_df_add_sub_LF <- CeA_df_final_LF %>% dplyr::filter(Experiment %in% c("AZD8797", "minocycline"))

CeA_df_azd_sub <- CeA_df_final %>% dplyr::filter(Experiment %in% c("AZD8797"))
CeA_df_azd_sub_RS <- CeA_df_final_RS %>% dplyr::filter(Experiment %in% c("AZD8797"))
CeA_df_azd_sub_LF <- CeA_df_final_LF %>% dplyr::filter(Experiment %in% c("AZD8797"))



# GAIN
bp_CeA_RS_thres <- plot_boxplot(CeA_df_azd_sub_RS, Treshold1_all, mtitle= "Regular-Spiking", ylabel = "Treshold_all1", dot_size = 2)
# bp_CeA_RS_thres <- bp_CeA_RS_thres + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), strip.text = element_text(size = 11, face="bold"), strip.background = element_blank())  + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)

bp_CeA_LF_thres <- plot_boxplot(CeA_df_azd_sub_LF, Treshold1_all, mtitle= "Late-Firing", ylabel = "Treshold_all1",  dot_size = 2)
# bp_CeA_LF_thres <- bp_CeA_LF_thres + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), strip.text = element_text(size = 11, face="bold"), strip.background = element_blank())  + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)

# ADAPTATION
bp_CeA_RS_adap <- plot_boxplot(CeA_df_azd_sub_RS, Adaptation_ratio, ylabel = "Adaptation ratio", mtitle = "Regular-Spiking", vary1 = 0, vary2 = 1.5, dot_size = 2)
# bp_CeA_RS_adap <- bp_CeA_RS_adap + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),
#   strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)

bp_CeA_LF_adap <- plot_boxplot(CeA_df_azd_sub_LF, Adaptation_ratio, ylabel = "Adaptation ratio", mtitle = "Late-Firing", vary1 = 0, vary2 = 1.5, dot_size = 2)
# bp_CeA_LF_adap <- bp_CeA_LF_adap + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5),
#   strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)

# INPUT RESISTANCE
# bp_CeA_RS_rm <- plot_boxplot(CeA_df_azd_sub_RS, Rm_20, ylabel = "Input resistance (MOhm)", mtitle = "Input resistance", vary1 = 0, vary2 = 250, dot_size = 2)
# bp_CeA_RS_rm <- bp_CeA_RS_rm + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), 
#   strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center') 
# 
# bp_CeA_LF_rm <- plot_boxplot(CeA_df_azd_sub_LF, Rm_20, ylabel = "Input resistance (MOhm)", mtitle = "Input resistance", vary1 = 0, vary2 = 250, dot_size = 2)
# bp_CeA_LF_rm <- bp_CeA_LF_rm + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), 
#   strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center') 

# TAU
# bp_CeA_RS_tau <- plot_boxplot(CeA_df_azd_sub_RS, tau_20, ylabel = "tau (ms)", mtitle = "tau", vary1 = 0, vary2 = 40, dot_size = 2)
# bp_CeA_RS_tau <- bp_CeA_RS_tau + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), 
#   strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)
# 
# bp_CeA_LF_tau <- plot_boxplot(CeA_df_azd_sub_LF, tau_20, ylabel = "tau (ms)", mtitle = "tau", vary1 = 0, vary2 = 40, dot_size = 2)
# bp_CeA_LF_tau <- bp_CeA_LF_tau + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), 
#   strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)


# CAPACITANCE
bp_CeA_RS_cap <- plot_boxplot(CeA_df_azd_sub_RS, C_20, ylabel = "Capacitance (pF)", mtitle = "Regular-Spiking", dot_size = 2)
# bp_CeA_RS_cap <- bp_CeA_RS_cap + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), 
#   strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)

bp_CeA_LF_cap <- plot_boxplot(CeA_df_azd_sub_LF, C_20, ylabel = "Capacitance (pF)", mtitle = "Late-Firing", dot_size = 2)
# bp_CeA_LF_cap <- bp_CeA_LF_cap + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), 
#   strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)

# SAG
# bp_BLA_sag <- plot_boxplot(BLA_df_sag, sag_ratio_140, ylabel = "sag ratio @-140 pA", mtitle = "sag ratio", dot_size = 2)
# bp_BLA_sag <- bp_BLA_sag + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), 
#   strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) + stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)


# RESTING MEMBRANE POTENTIAL
# bp_CeA_RS_vm <- plot_boxplot(CeA_df_azd_sub_RS, RMS, ylabel = "Resting membrane potential (mV)", mtitle = "Resting membrane potential", vary1 = -90, vary2 = -45, dot_size = 2)
# bp_CeA_RS_vm <- bp_CeA_RS_vm + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), 
#   strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) #+ stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)

# bp_CeA_LF_vm <- plot_boxplot(CeA_df_azd_sub_LF, RMS, ylabel = "Resting membrane potential (mV)", mtitle = "Resting membrane potential", vary1 = -90, vary2 = -45, dot_size = 2)
# bp_CeA_LF_vm <- bp_CeA_LF_vm + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), 
#   strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) 

# ACTION POTENTIAL WIDTH
bp_CeA_RS_apw <- plot_boxplot(CeA_df_azd_sub_RS, AP_width1_all, ylabel = "Action potential width (ms)", mtitle = "Regular-Spiking", dot_size = 2)
# bp_CeA_RS_apw  <- bp_CeA_RS_apw  + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), 
#   strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) #+ stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)
bp_CeA_LF_apw <- plot_boxplot(CeA_df_azd_sub_LF, AP_width1_all, ylabel = "Action potential width (ms)", mtitle = "Late-Firing", dot_size = 2)
# bp_CeA_LF_apw  <- bp_CeA_LF_apw  + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), 
#   strip.text = element_text(size = 11, face="bold"), strip.background = element_blank())

# ACTION POTENTIAL AMPLITUDE
bp_CeA_RS_apa <- plot_boxplot(CeA_df_azd_sub_RS, AP_amp1_all, ylabel = "Action potential amplitude (pA)", mtitle = "Regular-Spiking", dot_size = 2)
# bp_CeA_RS_apa <- bp_CeA_RS_apa + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), 
#   strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) #+ stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)
bp_CeA_LF_apa <- plot_boxplot(CeA_df_azd_sub_LF, AP_amp1_all, ylabel = "Action potential amplitude (pA)", mtitle = "Late-Firing", dot_size = 2)
# bp_CeA_LF_apa <- bp_CeA_LF_apa + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), 
#   strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) 

# FAST AHP
bp_CeA_RS_fast <- plot_boxplot(CeA_df_azd_sub_RS, AHPf1_all, ylabel = "fast AHP (pA)", mtitle = "Regular-Spiking", dot_size = 2)
# bp_CeA_RS_fast <- bp_CeA_RS_fast + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), 
#   strip.text = element_text(size = 11, face="bold"), strip.background = element_blank()) #+ stat_compare_means(method = 't.test', hide.ns = TRUE, label = 'p.signif', paired = TRUE, label.x.npc = 'center', var.equal = TRUE)
bp_CeA_LF_fast <- plot_boxplot(CeA_df_azd_sub_LF, AHPf1_all, ylabel = "fast AHP (pA)", mtitle = "Late-Firing",  dot_size = 2)
# bp_CeA_LF_fast <- bp_CeA_LF_fast + facet_wrap(~ Experiment, nrow = 1, scales = "free_x") + theme(plot.title = element_text(size= 16, face="bold"), axis.text.x = element_text(angle = 30, vjust = 0.7, hjust=0.5), 
#   strip.text = element_text(size = 11, face="bold"), strip.background = element_blank())

# making final figure with patchwork
lay <- "
AB
CD
EF
"

A <- (bp_CeA_RS_thres | bp_CeA_LF_thres) + plot_layout(tag_level = 'new')
B <- (bp_CeA_RS_adap | bp_CeA_LF_adap) + plot_layout(tag_level = 'new')
C <- (bp_CeA_RS_cap | bp_CeA_LF_cap) + plot_layout(tag_level = 'new')
D <- (bp_CeA_RS_apw | bp_CeA_LF_apw) + plot_layout(tag_level = 'new')
E <- (bp_CeA_RS_apa | bp_CeA_LF_apa) + plot_layout(tag_level = 'new')
F <- (bp_CeA_RS_fast | bp_CeA_LF_fast) + plot_layout(tag_level = 'new')

figure1 <- wrap_plots(A = A, B = B, C = C, D = D, E = E, F = F, design = lay)

figure1 <- figure1 + plot_annotation(tag_levels = c('a', '1'))


figure1


```

## PhD thesis founding
This PhD thesis and candidate were supported by:   

* **National Science Centre Poland doctoral scholarship, ETIUDA**: Wpływ wybranych chemokin na właściwości komórek nerwowych i przekaźnictwo synaptyczne w obszarze kompleksu ciała migdałowatego szczura [Effects of chosen chemokines on neuronal properties and synaptic transmission in central and basolateral complex of the rat amygdala], UMO-2019/32/T/NZ4/00592 - grant holder 2019-2020

* **National Science Centre Poland Grant, PRELUDIUM**: 	Wpływ wybranych chemokin na aktywność oraz transmisję synaptyczną neuronów w centralnym i podstawnobocznym kompleksie ciała migdałowatego [Effects of chosen chemokines on neuronal activity and synaptic transmission in central and basolateral complex of the amygdala], UMO-2016/21/N/NZ4/03621, grant holder 2016-2020 <!--(grant holder: Joanna Ewa Sowa)-->

## PhD candidate’s scientific activity
### Regarding PhD thesis
#### Publications
#### Oral presentations
#### Posters

### Other
#### Publications
#### Oral presentations
#### Posters

